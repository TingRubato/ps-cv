<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://tingrubato.github.io/ps-cv/feed.xml" rel="self" type="application/atom+xml"/><link href="https://tingrubato.github.io/ps-cv/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-01-03T17:33:52+00:00</updated><id>https://tingrubato.github.io/ps-cv/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">A quantified way to evaluate your EB2-NIW Petition</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/quantified-niw/" rel="alternate" type="text/html" title="A quantified way to evaluate your EB2-NIW Petition"/><published>2024-12-04T01:59:00+00:00</published><updated>2024-12-04T01:59:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/quantified-niw</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/quantified-niw/"><![CDATA[<h2 id="introduction"><strong>Introduction</strong></h2> <p>The regulations outlined in 8 CFR § 204.5(k) define the eligibility criteria for second-preference employment-based immigrant visas (EB-2), including the requirements for a National Interest Waiver (NIW). Historically, petitions were evaluated under the <em>Matter of New York State Dept. of Transportation</em> (NYSDOT), a framework often criticized for its opaque standards and inconsistent application. In response, <em>Matter of Dhanasar</em>, 26 I&amp;N Dec. 884 (AAO 2016), introduced a clearer, more flexible three-prong test to guide U.S. Citizenship and Immigration Services (USCIS) adjudicators.</p> <p>Dhanasar’s three-prong framework requires that a petitioner demonstrate:</p> <ol> <li><strong>Substantial Merit and National Importance</strong></li> <li><strong>Positioning to Advance the Proposed Endeavor</strong></li> <li><strong>Balancing the National Interest</strong></li> </ol> <p>USCIS typically assesses these prongs sequentially. If <strong>Prong 1</strong> is not met, further analysis ends. Only upon passing <strong>Prong 1</strong> do they evaluate <strong>Prong 2</strong>, and only if both prongs are satisfied do they proceed to <strong>Prong 3</strong>. This hierarchical structure necessitates a mathematical model that reflects conditional progression, ensuring that each subsequent evaluation is grounded in the validated findings of the previous stage.</p> <p>Earlier attempts at modeling the NIW framework as independent axes in a three-dimensional coordinate system did not account for this sequential logic. Instead, we now introduce a refined, tiered model that aligns with the adjudication process. This approach uses a structured, stepwise scoring system, applying well-defined thresholds at each prong before advancing to the next. Such a model offers transparency, consistency, and the mathematical rigor needed to ensure equitable and logical adjudications.</p> <hr/> <h2 id="conceptual-foundations-sequential-evaluation-of-dhanasars-prongs"><strong>Conceptual Foundations: Sequential Evaluation of Dhanasar’s Prongs</strong></h2> <div id="chart-sunburst"></div> <script src="/ps-cv/assets/js/chart/chart-sunburst.js" defer=""></script> <script>document.addEventListener("DOMContentLoaded",function(){"function"==typeof renderSunburstChart?renderSunburstChart("#chart-sunburst"):console.error("Function 'renderSunburstChart' is not defined.")});</script> <p>Our improved mathematical model integrates conditional logic with weighted scoring. In essence, each prong is a “gate” that must be cleared before proceeding. This ensures that time and analytic effort are focused on the criteria relevant to the petitioner’s demonstrated accomplishments and potential. The model’s core principle is to maintain strict adherence to the Dhanasar framework while quantifying each determination to minimize subjectivity.</p> <hr/> <h3 id="prong-1-substantial-merit-and-national-importance"><strong>Prong 1: Substantial Merit and National Importance</strong></h3> <p>This first prong considers whether the proposed endeavor has substantial merit and national importance. Under <em>Matter of Dhanasar</em>, this includes fields such as education, technology, public health, or environmental improvements, and can account for direct or indirect benefits. Notably, an undertaking need not have an immediate quantifiable economic impact; it suffices if it presents a clear, plausible path to substantial merit on a national scale.</p> <h4 id="mathematical-model-for-prong-1"><strong>Mathematical Model for Prong 1:</strong></h4> <p>We employ a <strong>binary scoring matrix</strong> augmented by category importance. Each category contributes a point (1 or 0), and certain categories are “key” indicators with a higher weight. The petitioner’s total score is a weighted sum of these indicators. The final score is normalized to a scale of 0 to 8, allowing for straightforward interpretation.</p> <table> <thead> <tr> <th><strong>Category</strong></th> <th><strong>Criteria</strong></th> <th><strong>Base Score</strong></th> <th><strong>Weight</strong></th> <th><strong>Weighted Score</strong></th> </tr> </thead> <tbody> <tr> <td>Substantial Merit</td> <td>Contributions to major fields (science, tech, health, etc.)</td> <td>1 or 0</td> <td>1.0</td> <td>Score * Weight</td> </tr> <tr> <td>Non-Quantifiable Impact</td> <td>Establishes value even if not purely economic</td> <td>1 or 0</td> <td>0.8</td> <td>Score * Weight</td> </tr> <tr> <td>Prospective Scientific/Research Impact</td> <td>Potential for advancing knowledge</td> <td>1 or 0</td> <td>1.0</td> <td>Score * Weight</td> </tr> <tr> <td>Detailed Explanation of Merit</td> <td>Clear, well-substantiated rationale</td> <td>1 or 0</td> <td>1.0</td> <td>Score * Weight</td> </tr> <tr> <td>National/Global Implications</td> <td>Broad scope, beyond local/regional</td> <td>1 or 0</td> <td>1.0</td> <td>Score * Weight</td> </tr> <tr> <td>Potential Economic Impact</td> <td>Prospects for job creation or economic growth</td> <td>1 or 0</td> <td>0.9</td> <td>Score * Weight</td> </tr> <tr> <td>Focused Regional Impact but Broad Relevance</td> <td>Locally rooted but with lessons/benefits of wider interest</td> <td>1 or 0</td> <td>0.9</td> <td>Score * Weight</td> </tr> <tr> <td>Specificity of Contribution</td> <td>Petitioner’s unique role and importance</td> <td>1 or 0</td> <td>1.0</td> <td>Score * Weight</td> </tr> </tbody> </table> <ul> <li><strong>Passing Threshold:</strong> Calculate the weighted sum: \(\text{Prong 1 Score} = \sum (\text{Score}_i \times \text{Weight}_i)\) Prong 1 is satisfied if the weighted sum ≥ 6.0.</li> </ul> <p><strong>Outcome:</strong> Pass or Fail. If the petitioner passes Prong 1, proceed to Prong 2.</p> <hr/> <h3 id="prong-2-positioning-to-advance-the-proposed-endeavor"><strong>Prong 2: Positioning to Advance the Proposed Endeavor</strong></h3> <p>If Prong 1 is met, we consider whether the petitioner is well-positioned to realize the endeavor’s potential. Factors include the petitioner’s expertise, the feasibility of their proposed plan, prior achievements, and external support. This prong is more nuanced and benefits from a weighted scoring model that acknowledges both the quality and relevance of evidence.</p> <h4 id="mathematical-model-for-prong-2"><strong>Mathematical Model for Prong 2:</strong></h4> <p>We use a weighted average approach. Each component receives points, then we normalize to a 100-point scale. This ensures balanced consideration of the petitioner’s qualifications and practical planning.</p> <table> <thead> <tr> <th><strong>Component</strong></th> <th><strong>Weight</strong></th> <th><strong>Max Points</strong></th> <th><strong>Description</strong></th> </tr> </thead> <tbody> <tr> <td>Education, Skills, Knowledge</td> <td>25%</td> <td>25</td> <td>Degrees, specialized training, and recognized expertise</td> </tr> <tr> <td>Record of Success</td> <td>25%</td> <td>25</td> <td>Publications, patents, awards, and notable achievements</td> </tr> <tr> <td>Model or Plan</td> <td>20%</td> <td>20</td> <td>Detailed strategic plan outlining milestones and risks</td> </tr> <tr> <td>Progress Made</td> <td>15%</td> <td>15</td> <td>Demonstrable advancement: prototypes, trials, pilots</td> </tr> <tr> <td>External Validation</td> <td>15%</td> <td>15</td> <td>Letters of support, MOUs, endorsements, partnerships</td> </tr> </tbody> </table> <p>Final Prong 2 score: \(\text{Prong 2 Score} = ( \text{Educ/Skills} + \text{Record} + \text{Plan} + \text{Progress} + \text{Validation} )\)</p> <p><strong>Normalization Example:</strong> If all components are scored out of their respective maximums and summed to a total of 100 points, simply sum the allocated points. If fewer than 70 points are earned, the petitioner fails Prong 2.</p> <ul> <li><strong>Passing Threshold:</strong> Prong 2 is satisfied if ≥ 70/100 points.</li> </ul> <p><strong>Outcome:</strong> Pass or Fail. If the petitioner passes Prong 2, proceed to Prong 3.</p> <hr/> <h3 id="prong-3-balancing-the-national-interest"><strong>Prong 3: Balancing the National Interest</strong></h3> <p>If the petitioner passes Prongs 1 and 2, we then consider whether, on balance, granting the NIW benefits the United States. This includes showing that requiring a labor certification would be contrary to the national interest, that the petitioner’s contribution is distinct enough to override labor market protections, and that there is a compelling, often time-sensitive reason for immediate implementation.</p> <h4 id="mathematical-model-for-prong-3"><strong>Mathematical Model for Prong 3:</strong></h4> <p>We apply a weighted scoring system focusing on three core factors, summing to 100 points:</p> <table> <thead> <tr> <th><strong>Factor</strong></th> <th><strong>Weight</strong></th> <th><strong>Max Points</strong></th> <th><strong>Description</strong></th> </tr> </thead> <tbody> <tr> <td>Impracticality of Labor Certification</td> <td>30%</td> <td>30</td> <td>Difficulty in replacing or replicating petitioner’s contributions through U.S. labor market testing</td> </tr> <tr> <td>Distinctive Contributions</td> <td>30%</td> <td>30</td> <td>Unique skill sets, exceptional talent, rare expertise</td> </tr> <tr> <td>Urgency of National Interest</td> <td>40%</td> <td>40</td> <td>Critical timing: immediate need to address pressing national objectives</td> </tr> </tbody> </table> <p>Sum the scores from each factor to yield a total out of 100. A robust showing in urgency or distinctiveness can offset slight shortfalls in other areas, reflecting a holistic assessment.</p> <ul> <li><strong>Passing Threshold:</strong> Prong 3 is satisfied if ≥ 75/100 points.</li> </ul> <p><strong>Outcome:</strong> Approval (if passed) or Denial (if failed).</p> <hr/> <h2 id="a-real-example-quantified-evaluation-for-niw-eligibility"><strong>A Real Example: Quantified Evaluation for NIW Eligibility</strong></h2> <p>Consider <strong>Dr. Jane Doe</strong>, a biomedical researcher using AI-driven diagnostics to improve early detection of pancreatic cancer.</p> <h3 id="prong-1-substantial-merit-and-national-importance-1"><strong>Prong 1: Substantial Merit and National Importance</strong></h3> <table> <thead> <tr> <th><strong>Category</strong></th> <th>Score</th> <th>Weight</th> <th>Weighted Score</th> </tr> </thead> <tbody> <tr> <td>Substantial Merit</td> <td>1</td> <td>1.0</td> <td>1.0</td> </tr> <tr> <td>Non-Quantifiable Impact</td> <td>1</td> <td>0.8</td> <td>0.8</td> </tr> <tr> <td>Prospective Scientific/Research Impact</td> <td>1</td> <td>1.0</td> <td>1.0</td> </tr> <tr> <td>Detailed Explanation of Merit</td> <td>1</td> <td>1.0</td> <td>1.0</td> </tr> <tr> <td>National/Global Implications</td> <td>1</td> <td>1.0</td> <td>1.0</td> </tr> <tr> <td>Potential Economic Impact</td> <td>1</td> <td>0.9</td> <td>0.9</td> </tr> <tr> <td>Focused Regional Impact, Broad Scope</td> <td>1</td> <td>0.9</td> <td>0.9</td> </tr> <tr> <td>Specificity of Contribution</td> <td>1</td> <td>1.0</td> <td>1.0</td> </tr> </tbody> </table> <blockquote> <h5 id="prong-1-score">PRONG 1 SCORE:</h5> <p><strong>Total Weighted Score:</strong> 1.0 + 0.8 + 1.0 + 1.0 + 1.0 + 0.9 + 0.9 + 1.0 = 7.6/8.0</p> <p class="block-blue">Prong 1 Passed (≥6.0 required).</p> </blockquote> <hr/> <h3 id="prong-2-positioning-to-advance-the-proposed-endeavor-1"><strong>Prong 2: Positioning to Advance the Proposed Endeavor</strong></h3> <table> <thead> <tr> <th><strong>Component</strong></th> <th>Score</th> </tr> </thead> <tbody> <tr> <td>Education, Skills, Knowledge (25 max)</td> <td>23/25</td> </tr> <tr> <td>Record of Success (25 max)</td> <td>20/25</td> </tr> <tr> <td>Model or Plan (20 max)</td> <td>18/20</td> </tr> <tr> <td>Progress Made (15 max)</td> <td>12/15</td> </tr> <tr> <td>External Validation (15 max)</td> <td>13/15</td> </tr> </tbody> </table> <blockquote> <h5 id="prong-2-score">PRONG 2 SCORE:</h5> <p><strong>Total Score:</strong> 23+20+18+12+13 = 86/100</p> <p class="block-blue">Prong 2 Passed (≥70 required).</p> </blockquote> <hr/> <h3 id="prong-3-balancing-the-national-interest-1"><strong>Prong 3: Balancing the National Interest</strong></h3> <table> <thead> <tr> <th><strong>Factor</strong></th> <th>Score</th> </tr> </thead> <tbody> <tr> <td>Impracticality of Labor Certification (30 max)</td> <td>28/30</td> </tr> <tr> <td>Distinctive Contributions (30 max)</td> <td>25/30</td> </tr> <tr> <td>Urgency of National Interest (40 max)</td> <td>35/40</td> </tr> </tbody> </table> <blockquote> <h5 id="prong-3-score">PRONG 3 SCORE:</h5> <p><strong>Total Score:</strong> 28+25+35 = 88/100</p> <p class="block-blue">Prong 3 Passed (≥75 required).</p> </blockquote> <h3 id="final-decision"><strong>Final Decision:</strong></h3> <p>Dr. Doe qualifies for the National Interest Waiver.</p> <hr/> <h2 id="conclusion-a-structured-quantifiable-approach"><strong>Conclusion: A Structured, Quantifiable Approach</strong></h2> <p>This refined model uses a staged, mathematically grounded methodology that mirrors the Dhanasar framework’s sequential logic. Prong 1’s foundational threshold ensures that only nationally significant endeavors proceed. Prong 2’s weighted scoring underscores the petitioner’s readiness and capability. Finally, Prong 3 balances these findings against the broader national interest, offering a transparent, consistent, and data-driven decision process. By integrating clear criteria, conditional logic, and numerical thresholds, this model enhances fairness, reduces subjectivity, and provides a roadmap for systematic NIW adjudication.</p>]]></content><author><name></name></author><category term="work"/><category term="legal"/><category term="analysis"/><summary type="html"><![CDATA[A quantified methods to evaluate your EB2-NIW petition.]]></summary></entry><entry><title type="html">USCIS Stability?</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/uscis-stability/" rel="alternate" type="text/html" title="USCIS Stability?"/><published>2024-10-01T16:40:16+00:00</published><updated>2024-10-01T16:40:16+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/uscis-stability</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/uscis-stability/"><![CDATA[<blockquote> <h5 id="warning">WARNING</h5> <p class="block-danger">For entertainment purposes only.<br/> Feel free to judge, but please be kind.</p> </blockquote> <p>Hello, everyone! Let’s discuss how vital NIW (National Interest Waiver) applications are in U.S. immigration. This special option under the EB-2 category essentially provides a “backdoor” to a Green Card for highly skilled professionals who can make major contributions to the United States.</p> <p>Today, we’ll apply Lyapunov stability theory to examine how the NIW application processing system operates. Why Lyapunov stability theory? Because it helps us assess whether a system (in this case, the USCIS NIW application process) can return to equilibrium after being disturbed—something I’ve wanted to understand better since I never fully grasped system identification basics during the pandemic.</p> <p>We’ll analyze NIW application data from 2019 to 2023 to see how the system responds to surges in applications or policy changes. By applying Lyapunov analysis, we can gain deeper insight into the system’s stability, adaptability, and long-term sustainability. This not only helps us understand current NIW processing better, but it can also offer a strategic advantage for applicants.</p> <p>Sound interesting? Let’s begin by looking at the NIW application data trends, build a Lyapunov stability model, and then dive into a detailed discussion of the system’s stability.</p> <hr/> <table> <thead> <tr> <th>Year</th> <th>Receipts</th> <th>Completions</th> <th>New Incomplete</th> <th>Cumulative Backlog</th> </tr> </thead> <tbody> <tr> <td><strong>2019</strong></td> <td>12,510</td> <td>7,390</td> <td>5,120</td> <td>5,120</td> </tr> <tr> <td><strong>2020</strong></td> <td>14,310</td> <td>10,520</td> <td>3,790</td> <td>8,910</td> </tr> <tr> <td><strong>2021</strong></td> <td>14,610</td> <td>11,210</td> <td>3,400</td> <td>12,310</td> </tr> <tr> <td><strong>2022</strong></td> <td>21,990</td> <td>21,230</td> <td>760</td> <td>13,070</td> </tr> <tr> <td><strong>2023</strong></td> <td>39,810</td> <td>39,840</td> <td>-30</td> <td>13,040</td> </tr> </tbody> </table> <p><strong>Table 1: EB-2 Category NIW Total Receipts, Completions, and Approvals, FY 2023 USCIS[2]</strong><br/> <strong>Note: The cumulative backlog does not include cases pending before 2018.</strong></p> <hr/> <h2 id="key-data-points">Key Data Points</h2> <h3 id="i-in-depth-analysis-of-backlog-trends">I. In-Depth Analysis of Backlog Trends</h3> <h4 id="a-20192021-backlog-increased-year-by-year">A. 2019–2021: Backlog Increased Year by Year</h4> <ul> <li><strong>Steady Increase in Receipts</strong>: From 12,510 in 2019 to 14,610 in 2021 (up 16.8%).</li> <li><strong>Slower Growth in Completions</strong>: From 7,390 in 2019 to 11,210 in 2021 (up 51.7%, but not enough to offset the growth in receipts).</li> <li><strong>Cumulative Backlog Effect</strong>: From 5,120 in 2019 to 12,310 in 2021 (a 2.4-fold increase).</li> <li><strong>Pandemic Impact</strong>: USCIS office closures, staffing shortages, and remote work led to fewer completions.</li> </ul> <pre><code class="language-echarts">{
   "title": {
      "text": "Backlog and Case Processing Trends (2019-2021)",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": {
         "type": "shadow"
      }
   },
   "legend": {
      "top": "10%",
      "data": ["Receipts", "Completions", "Backlog"]
   },
   "xAxis": {
      "type": "category",
      "data": ["2019", "2020", "2021"]
   },
   "yAxis": {
      "type": "value",
      "name": "Counts",
      "min": 0
   },
   "series": [
      {
         "name": "Receipts",
         "type": "bar",
         "data": [12510, 13890, 14610],
         "itemStyle": {
            "color": "rgba(54, 162, 235, 0.8)"
         }
      },
      {
         "name": "Completions",
         "type": "bar",
         "data": [7390, 9100, 11210],
         "itemStyle": {
            "color": "rgba(75, 192, 192, 0.8)"
         }
      },
      {
         "name": "Backlog",
         "type": "bar",
         "data": [5120, 8790, 12310],
         "itemStyle": {
            "color": "rgba(255, 159, 64, 0.8)"
         }
      }
   ]
}
</code></pre> <h4 id="b-2022-significant-improvement-in-processing-efficiency">B. 2022: Significant Improvement in Processing Efficiency</h4> <ul> <li><strong>Surge in Receipts</strong>: 21,990 (50.5% increase over 2021)</li> <li><strong>Major Increase in Completions</strong>: 21,230 (up 89.4% from 2021)</li> <li><strong>Backlog Growth Slows</strong>: Only 760 new incomplete cases</li> <li><strong>Possible Reasons</strong>: More staffing, introduction of automation, streamlined processes</li> </ul> <pre><code class="language-echarts">{
   "title": {
      "text": "Case Processing Trends (2022)",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": {
         "type": "shadow"
      }
   },
   "legend": {
      "top": "10%",
      "data": ["Receipts", "Completions", "Backlog Growth"]
   },
   "xAxis": {
      "type": "category",
      "data": ["2022"]
   },
   "yAxis": {
      "type": "value",
      "name": "Counts",
      "min": 0
   },
   "series": [
      {
         "name": "Receipts",
         "type": "bar",
         "data": [21990],
         "itemStyle": {
            "color": "rgba(54, 162, 235, 0.8)"
         }
      },
      {
         "name": "Completions",
         "type": "bar",
         "data": [21230],
         "itemStyle": {
            "color": "rgba(75, 192, 192, 0.8)"
         }
      },
      {
         "name": "Backlog Growth",
         "type": "bar",
         "data": [760],
         "itemStyle": {
            "color": "rgba(255, 159, 64, 0.8)"
         }
      }
   ]
}
</code></pre> <h4 id="c-2023-system-enters-a-new-equilibrium">C. 2023: System Enters a New Equilibrium</h4> <ul> <li><strong>Receipts and Completions Nearly Equal</strong>: 39,810 vs. 39,840</li> <li><strong>Negative New Incompletes</strong>: -30, reducing some backlog</li> <li><strong>Slight Decrease in Cumulative Backlog</strong>: From 13,070 to 13,040</li> <li><strong>Increased Processing Capacity</strong>: Completions are 5.4 times the figure in 2019.</li> </ul> <pre><code class="language-echarts">{
   "title": {
      "text": "Case Processing Trends (2023)",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": {
         "type": "shadow"
      }
   },
   "legend": {
      "top": "10%",
      "data": ["Receipts", "Completions", "Backlog Change"]
   },
   "xAxis": {
      "type": "category",
      "data": ["2023"]
   },
   "yAxis": {
      "type": "value",
      "name": "Counts",
      "min": -50
   },
   "series": [
      {
         "name": "Receipts",
         "type": "bar",
         "data": [39810],
         "itemStyle": {
            "color": "rgba(54, 162, 235, 0.8)"
         }
      },
      {
         "name": "Completions",
         "type": "bar",
         "data": [39840],
         "itemStyle": {
            "color": "rgba(75, 192, 192, 0.8)"
         }
      },
      {
         "name": "Backlog Change",
         "type": "bar",
         "data": [-30],
         "itemStyle": {
            "color": "rgba(255, 159, 64, 0.8)"
         }
      }
   ]
}
</code></pre> <h3 id="ii-in-depth-exploration-of-system-stability">II. In-Depth Exploration of System Stability</h3> <h4 id="a-backlog-remains-stable-or-even-decreases">A. Backlog Remains Stable or Even Decreases</h4> <ul> <li><strong>Backlog Under Control</strong>: Despite a big increase in receipts during 2022-2023, backlog did not rise significantly</li> <li><strong>Enhanced Adaptability</strong>: USCIS shows stable processing capability under high application volumes</li> <li><strong>Potential Risk</strong>: Persistent rapid growth in receipts could lead to new backlog issues</li> </ul> <h4 id="matching-growth-in-completions-to-growth-in-receipts">Matching Growth in Completions to Growth in Receipts</h4> <ul> <li><strong>Completions Grow Faster</strong>: From 2022 to 2023, completions grew faster than receipts</li> <li><strong>Sustained Increase in Completions</strong>: From 2019 to 2023, completions grew at an average rate of 53.2% annually, compared to 34.8% for receipts</li> <li><strong>Contribution to Stability</strong>: The rapid increase in completions is key to system stability</li> </ul> <h3 id="iii-in-depth-analysis-of-application-volume-changes">III. In-Depth Analysis of Application Volume Changes</h3> <h4 id="a-reasons-behind-the-application-surge">A. Reasons Behind the Application Surge</h4> <ul> <li><strong>Policy Changes</strong>: Possible easing of NIW requirements in 2022</li> <li><strong>Employment Environment</strong>: Big tech companies halting PERM applications and layoffs push STEM talent toward NIW</li> <li><strong>International Factors</strong>: Global political conditions and the pandemic lead overseas talent to choose U.S. immigration</li> </ul> <pre><code class="language-echarts">{
    "title": {
        "text": "Receipts vs. Completions (2019-2023)",
        "left": "center"
    },
    "tooltip": {
        "trigger": "axis"
    },
    "legend": {
        "top": "10%",
        "data": ["Receipts", "Completions"]
    },
    "xAxis": {
        "type": "category",
        "data": ["2019", "2020", "2021", "2022", "2023"]
    },
    "yAxis": {
        "type": "value",
        "name": "Counts"
    },
    "series": [
        {
            "name": "Receipts",
            "type": "line",
            "data": [12510, 13890, 14610, 21990, 39810],
            "itemStyle": {
                "color": "rgba(54, 162, 235, 0.8)"
            }
        },
        {
            "name": "Completions",
            "type": "line",
            "data": [7390, 9100, 11210, 21230, 39840],
            "itemStyle": {
                "color": "rgba(75, 192, 192, 0.8)"
            }
        }
    ]
}
</code></pre> <h4 id="b-application-growth-trend">B. Application Growth Trend</h4> <ul> <li><strong>Significant Growth in 2022</strong>: 50.5% increase over 2021</li> <li><strong>Further Growth in 2023</strong>: 39,810 cases, up 81% over 2022, 3.18 times 2019’s figure</li> <li> <p><strong>Future Outlook</strong>: USCIS must further increase capacity to handle potential continued growth</p> <pre><code class="language-echarts">{
   "title": {
      "text": "Annual Growth Rates: Receipts vs. Completions",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": {
         "type": "line"
      }
   },
   "legend": {
      "top": "10%",
      "data": ["Receipts Growth", "Completions Growth"]
   },
   "xAxis": {
      "type": "category",
      "data": ["2019-2020", "2020-2021", "2021-2022", "2022-2023"]
   },
   "yAxis": {
      "type": "value",
      "name": "Growth Rate (%)"
   },
   "series": [
      {
         "name": "Receipts Growth",
         "type": "line",
         "data": [11.0, 5.2, 50.5, 81.0],
         "itemStyle": {
            "color": "rgba(54, 162, 235, 0.8)"
         }
      },
      {
         "name": "Completions Growth",
         "type": "line",
         "data": [23.1, 23.0, 89.4, 87.6],
         "itemStyle": {
            "color": "rgba(75, 192, 192, 0.8)"
         }
      }
   ]
}
</code></pre> </li> </ul> <h3 id="iv-other-noteworthy-data-points">IV. Other Noteworthy Data Points</h3> <h4 id="a-changes-in-annual-backlog-increases">A. Changes in Annual Backlog Increases</h4> <ul> <li><strong>Reduced Backlog Increases</strong>: 3,400 in 2021 → 760 in 2022 → -30 in 2023.</li> </ul> <h4 id="2-significant-improvement-in-processing-efficiency"><strong>2. Significant Improvement in Processing Efficiency</strong></h4> <ul> <li><strong>Improved Completion Rate</strong>: From 59% in 2019 to 100.1% in 2023</li> </ul> <h4 id="3-changes-in-system-load"><strong>3. Changes in System Load</strong></h4> <ul> <li><strong>Absolute Values of Receipts and Completions Increased</strong>: Around 40,000 each in 2023</li> <li><strong>Matching Capacity and Load</strong>: The system remained efficient under high load</li> </ul> <hr/> <h2 id="lyapunov-stability-model">Lyapunov Stability Model</h2> <p>To analyze this system, we define our state variable as the <strong>backlog of unprocessed NIW cases</strong>.</p> <blockquote> <h5 id="why-choose-backlog-as-the-systems-state-variable">Why choose <strong>backlog</strong> as the system’s <strong>state variable</strong>?</h5> <ol> <li>Direct Reflection of System Load: Backlog measures the gap between receipts and completions.</li> <li>Core State of the Dynamic System: Continuous backlog increase indicates potential instability.</li> <li>Clear Definition of Equilibrium: Equilibrium means the backlog approaches zero (the rate of new cases vs. completions is balanced).</li> </ol> </blockquote> <p>To analyze the system more accurately, we split the state into <strong>two parts</strong>:</p> <ol> <li>Backlog \(B(t)\): Represents the current number of uncompleted cases in the system</li> <li>Backlog Rate of Change \(\frac{dB(t)}{dt}\): Describes how the backlog changes over time</li> </ol> <p>Thus we have:</p> \[\frac{dB(t)}{dt} = R(t) - C(t)+\eta(t)\] <ul> <li>\(B(t)\): NIW backlog at time t.</li> <li>\(R(t)\): Annual receipt volume</li> <li>\(C(t)\): Annual completion volume</li> <li>\(\eta(t)\): External disturbances, such as policy changes or international events</li> </ul> <p>This state equation shows <strong>how backlog changes over time</strong>, with receipts, completions, and external factors all influencing the backlog dynamics.</p> <h3 id="defining-the-lyapunov-function">Defining the Lyapunov Function</h3> \[V(B,\dot{B})=\alpha(B(t))^2+\beta(\frac{dB(t)}{dt})^2\] <ol> <li>\(B(t)^2\): Reflects the current magnitude of the backlog (system load).</li> <li>\((\frac{dB(t)}{dt})^2\): Measures the rate of change of backlog, capturing system dynamics.</li> <li>\(\alpha, \beta&gt;0\): Weighting factors to balance the influence of backlog magnitude and its rate of change.</li> </ol> <p>This Lyapunov function not only <strong>measures the backlog itself</strong> but also <strong>captures the rate of change</strong>, enabling a more comprehensive stability analysis.</p> <h2 id="dissect-the-equation">Dissect the Equation</h2> <ol> <li><strong>Calculating the Derivative of the Lyapunov Function \(V(B,\dot{B})\):</strong></li> </ol> \[\dot{V}(B, \dot{B}) = 2 \alpha B(t) \frac{dB(t)}{dt} + 2 \beta \frac{dB(t)}{dt} \cdot \frac{d^2 B(t)}{dt^2}\] <ol> <li><strong>Substituting the State Equation:</strong></li> </ol> \[\dot{V}(B, \dot{B}) = 2 \alpha B(t) \cdot (R(t) - C(t) + \eta(t)) + 2 \beta \left( R{\prime}(t) - C{\prime}(t) + \eta{\prime}(t) \right)\] <h2 id="stability-analysis">Stability Analysis:</h2> <h3 id="1-without-external-disturbance-etat0"><strong>1. Without External Disturbance (\(\eta(t)=0\)):</strong></h3> <p>The equation simplifies to:</p> \[\frac{dB(t)}{dt} = R(t) - C(t)\] <p>The Lyapunov function’s derivative becomes:</p> \[\dot{V}(B, \dot{B}) = 2 \alpha B(t) \cdot (R(t) - C(t)) + 2 \beta \frac{dB(t)}{dt} \cdot ( R{\prime}(t) - C{\prime}(t) )\] <h4 id="case-1-if-rt--ct-ie-completions-exceed-receipts"><strong>Case 1: If \(R(t) &lt; C(t)\), i.e., completions exceed receipts,</strong></h4> <p>\(R(t)-C(t)&lt;0\) and \(B(t)(R(t)-C(t))&lt;0\)</p> <ol> <li>The first term \(2 \alpha B(t)(R(t)-C(t))\) is negative.</li> <li>The second term \(2 \beta \frac{dB(t)}{dt}(R^{\prime}(t)-C^{\prime}(t))\) depends on the rate of change, but if \(\frac{dB(t)}{dt}&lt;0\), this term also tends to be negative.</li> </ol> <ul> <li>Conclusion: \(\dot{V}(B,\dot{B})&lt;0\) indicates <strong>the backlog is decreasing</strong>, showing <strong>asymptotic stability</strong>. Even if there’s initial backlog, the system will <strong>gradually return to zero backlog</strong>.</li> </ul> <h4 id="case-2-rt--ct-ie-completions-exceed-receipts"><strong>Case 2: \(R(t) &gt; C(t)\), i.e., completions exceed receipts,</strong></h4> <p>If \(R(t)-C(t)&gt;0\) and thus \(B(t)(R(t)-C(t))&gt;0\)</p> <ol> <li>The first term \(2 \alpha B(t)(R(t)-C(t))\) is positive, indicating <strong>backlog is increasing</strong>.</li> <li>The sign of the second term \(2 \beta \frac{dB(t)}{dt}(R^{\prime}(t)-C^{\prime}(t))\) depends on the rate of change. If <strong>receipts grow faster</strong> (\(R^{\prime}(t)&gt;C^{\prime}(t)\)), it’s also positive.</li> </ol> <ul> <li>Conclusion: \(\dot{V}(B,\dot{B})&gt;0\) shows backlog keeps rising and the system is <strong>unstable</strong>. Without increasing completions or reducing receipts, the backlog will continue to grow.</li> </ul> <h3 id="2-considering-external-disturbances-etatneq0"><strong>2. Considering External Disturbances \(\eta(t)\neq0\)</strong></h3> <p>In reality, external disturbances (policy shifts, economic crises, etc.) can have unpredictable effects on the system.</p> <p>Now the state equation is: \(\frac{dB(t)}{dt}=R(t)-C(t)+\eta(t)\)</p> <h4 id="case-1-large-sustained-external-disturbance"><strong>Case 1: Large, Sustained External Disturbance</strong></h4> <p>If \(\eta(t)\) is large and positive for a sustained period, the system’s dynamics are strongly affected.</p> <p>Even if \(C(t)&gt;R(t)\) would normally reduce backlog, due to the external disturbance:</p> \[\frac{dB(t)}{dt} = R(t) - C(t) + \eta(t)\] <p>If \(\eta(t)\) is large and positive, it’s possible that \(\frac{dB(t)}{dt}&gt;0\).</p> <p>This means <strong>backlog \(B(t)\) still increases</strong> even if the system’s processing capacity \(C(t)\) surpasses \(R(t)\).</p> <p>At this point, the Lyapunov function derivative is:</p> \[\dot{V}(B, \dot{B}) = 2\alpha B(t) [R(t) - C(t) + \eta(t)] + 2\beta \frac{dB(t)}{dt} [R{\prime}(t) - C{\prime}(t) + \eta{\prime}(t)]\] <ul> <li><strong>First Term</strong>: \(2\alpha B(t)[R(t)-C(t)+\eta(t)]\) might be positive because of the large \(\eta(t)\), increasing backlog.</li> <li><strong>Second Term</strong>: \(2\beta \frac{dB(t)}{dt}[R^{\prime}(t)-C^{\prime}(t)+\eta^{\prime}(t)]\) can also be positive if \(\eta^{\prime}(t)&gt;0\).</li> </ul> <p><strong>Interpretation:</strong></p> <ul> <li><strong>System Instability</strong>: \(\dot{V}(B,\dot{B})&gt;0\) indicates instability, backlog keeps rising.</li> <li><strong>Real-World Example</strong>: A sudden easing of immigration policies causing a surge in applications. Even if USCIS increases completions, backlog still grows.</li> <li><strong>Long-Term Impact</strong>: If disturbances persist, the system can’t recover on its own, requiring further intervention.</li> </ul> <h4 id="case-2-external-disturbance-small-and-non-continuous"><strong>Case 2: External Disturbance Small and Non-Continuous</strong></h4> <p>If \(\eta(t)\) is small and temporary:</p> <p>Once the disturbance ends, it returns to \(\frac{dB(t)}{dt}=R(t)-C(t)\).</p> <p>As long as \(C(t)&gt;R(t)\), \(R(t)-C(t)&lt;0\):</p> <ul> <li>The Lyapunov function derivative \(\dot{V}(B,\dot{B})&lt;0\), the system regains asymptotic stability, and the backlog decreases.</li> </ul> <p><strong>Interpretation:</strong></p> <ul> <li><strong>Self-Recovery</strong>: The system can return to stability after small, short-lived disturbances.</li> <li><strong>Real Example</strong>: Seasonal spikes in applications that USCIS can handle without significant backlog build-up.</li> </ul> <h3 id="comprehensive-analysis">Comprehensive Analysis:</h3> <ol> <li><strong>With External Disturbances</strong>: <ul> <li>Large, sustained disturbances → Hard for system to recover</li> <li>Small, short-lived disturbances → System returns to stability after they fade</li> </ul> </li> <li><strong>Without External Disturbances</strong>: <ul> <li>If \(R(t)&lt;C(t)\), backlog decreases, system stable</li> <li>If \(R(t)&gt;C(t)\), backlog grows, system unstable</li> </ul> </li> </ol> <h2 id="interpretation-of-results"><strong>Interpretation of Results:</strong></h2> <h3 id="system-stability-analysis"><strong>System Stability Analysis</strong></h3> <h4 id="1-evidence-of-asymptotic-stability">1. Evidence of Asymptotic Stability</h4> <p>2023 data shows the system is stabilizing:</p> <ul> <li>Receipts and completions nearly equal (39,810 vs 39,840)</li> <li>Backlog decreased slightly (-30 cases)</li> <li>Cumulative backlog down to 13,040</li> </ul> <p>These indicators show the system has reached a new equilibrium, demonstrating good asymptotic stability.</p> <h4 id="2-significant-improvement-in-processing-capacity">2. Significant Improvement in Processing Capacity</h4> <p>USCIS has greatly improved efficiency over the past five years:</p> <ul> <li>Completions rose from 7,390 in 2019 to 39,840 in 2023</li> <li>Over a fourfold increase, narrowing the \(R(t)\) and \(C(t)\) gap</li> </ul> <pre><code class="language-echarts">{
   "title": {
      "text": "Improved Processing Capacity (2019-2023)",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis"
   },
   "xAxis": {
      "type": "category",
      "data": ["2019", "2020", "2021", "2022", "2023"]
   },
   "yAxis": {
      "type": "value",
      "name": "Completions"
   },
   "series": [
      {
         "name": "Completions",
         "type": "line",
         "data": [7390, 9100, 11210, 21230, 39840],
         "itemStyle": { "color": "rgba(75, 192, 192, 0.8)" },
         "lineStyle": { "width": 3 }
      }
   ]
}
</code></pre> <h4 id="3-enhanced-stress-resistance">3. Enhanced Stress Resistance</h4> <p>Faced with a surge in applications (2022-2023), the system performed well:</p> <ul> <li>Maintained high completion volume</li> <li>Remained efficient under heavy load</li> </ul> <pre><code class="language-echarts">{
   "title": {
      "text": "Stress Resistance: High Volume Handling (2022-2023)",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": { "type": "shadow" }
   },
   "legend": {
      "top": "10%",
      "data": ["Receipts", "Completions"]
   },
   "xAxis": {
      "type": "category",
      "data": ["2022", "2023"]
   },
   "yAxis": {
      "type": "value",
      "name": "Counts"
   },
   "series": [
      {
         "name": "Receipts",
         "type": "bar",
         "stack": "Receipts",
         "data": [21990, 39810],
         "itemStyle": { "color": "rgba(54, 162, 235, 0.8)" },
         "label": {
            "show": true,
            "position": "inside",
            "formatter": "{c}"
         }
      },
      {
         "name": "Completions",
         "type": "bar",
         "stack": "Completions",
         "data": [21230, 39840],
         "itemStyle": { "color": "rgba(75, 192, 192, 0.8)" },
         "label": {
            "show": true,
            "position": "inside",
            "formatter": "{c}"
         }
      }
   ]
}
</code></pre> <h4 id="4-impact-of-policy-changes">4. Impact of Policy Changes</h4> <p>Policy shifts significantly affect the system:</p> <ul> <li>In 2022, big tech firms paused PERM, causing NIW receipts to surge to 21,990</li> <li>USCIS responded quickly, completing 21,230 and adding only 760 to backlog</li> </ul> <p>Uncertainty in future policies remains:</p> <ul> <li>The 2024 presidential election may alter immigration policies[1]</li> <li>Tightening policy may cause a short-term spike in \(R(t)\)</li> <li>Easing policy could sustain high application volumes</li> </ul> <p>These changes are sources of external disturbance \(\eta(t)\).</p> <pre><code class="language-echarts">{
   "title": {
      "text": "Impact of Policy Changes",
      "left": "center"
   },
   "tooltip": {
      "trigger": "item"
   },
   "legend": {
      "top": "10%",
      "left": "center"
   },
   "series": [
      {
         "name": "Factors",
         "type": "pie",
         "radius": "50%",
         "data": [
            { "value": 40, "name": "Policy Shifts" },
            { "value": 35, "name": "Economic Changes" },
            { "value": 25, "name": "Geopolitical Factors" }
         ],
         "itemStyle": {
            "emphasis": {
               "shadowBlur": 10,
               "shadowOffsetX": 0,
               "shadowColor": "rgba(0, 0, 0, 0.5)"
            }
         }
      }
   ]
}
</code></pre> <h4 id="5-influence-of-external-environment">5. Influence of External Environment</h4> <p><strong>Pandemic Impact</strong>: The backlog rose in 2020-2021 due to the pandemic, impact lessened after 2022.</p> <p><strong>Economic Fluctuations</strong>:</p> <ul> <li>Tech layoffs increase NIW applications</li> <li>Economic recovery may restart PERM, easing NIW pressure</li> </ul> <p><strong>Geopolitical Factors</strong>: International tensions can spur surges in high-skilled immigration.</p> <p>USCIS must adapt to maintain Lyapunov stability.</p> <pre><code class="language-echarts">{
   "title": {
      "text": "Backlog Evolution Under External Pressures",
      "left": "center"
   },
   "tooltip": {
      "trigger": "axis",
      "axisPointer": { "type": "shadow" }
   },
   "xAxis": {
      "type": "category",
      "data": ["2019", "2020", "2021", "2022", "2023"]
   },
   "yAxis": {
      "type": "value",
      "name": "Backlog"
   },
   "series": [
      {
         "name": "Backlog",
         "type": "line",
         "data": [5120, 8790, 12310, 13070, 13040],
         "areaStyle": { "color": "rgba(255, 159, 64, 0.3)" },
         "itemStyle": { "color": "rgba(255, 159, 64, 0.8)" }
      }
   ]
}
</code></pre> <h3 id="summary">Summary:</h3> <ul> <li><strong>Without Disturbances</strong>, stability depends on \(R(t)\) and \(C(t)\). Ensuring \(C(t)\ge R(t)\) is key.</li> <li><strong>With Disturbances</strong>, the magnitude and duration of \(\eta(t)\) matter. Anticipating and strategizing help maintain stability.</li> </ul> <h2 id="future-potential-disturbances-and-stability-risks-in-the-eb2-niw-system"><strong>Future Potential Disturbances and Stability Risks in the EB2-NIW System</strong></h2> <h3 id="i-policy-and-election-influences"><strong>I. Policy and Election Influences</strong></h3> <h4 id="1-uncertainty-of-the-2024-presidential-election-outcome">1. Uncertainty of the 2024 Presidential Election Outcome</h4> <p>Latest polls show the election between Harris and Trump, affecting immigration policy:</p> <ul> <li><strong>Easing Policy (Harris)</strong>: EB2-NIW surge, \(R(t)\) soars, potentially outstripping USCIS capacity.</li> <li><strong>Tightening Policy (Trump)</strong>: Stricter scrutiny, \(C(t)\) falls, short-term spike in \(R(t)\).</li> </ul> <p>If \(\eta(t)\gg0\) and \(R(t)&gt;C(t)\), \(\dot{V}(B,\dot{B})&gt;0\), instability occurs. USCIS must plan ahead.</p> <h4 id="ii-ripple-effects-of-big-tech-companies-pausing-perm"><strong>II. Ripple Effects of Big Tech Companies Pausing PERM</strong></h4> <p><strong>Amazon and Google Pausing PERM until 2025[3]</strong>:</p> <ul> <li>Talent shifts to NIW, \(R(t)\) surges</li> <li>If \(C(t)\) doesn’t rise, \(B(t)\) grows</li> </ul> <h4 id="iii-economic-fluctuations-and-labor-market-shocks"><strong>III. Economic Fluctuations and Labor Market Shocks</strong></h4> <p><strong>Mass Layoffs</strong>:</p> <ul> <li>PERM gets harder, more NIW applications</li> <li>With \(R(t)&gt;C(t)\) and \(\eta(t)&gt;0\), \(\dot{V}(B,\dot{B})&gt;0\) means instability</li> </ul> <p><strong>Economic Recovery</strong>:</p> <ul> <li>PERM resumes, \(R(t)\) drops, aiding stability</li> </ul> <p>USCIS should monitor economic indicators and optimize resources.</p> <h4 id="iv-technological-and-automated-support"><strong>IV. Technological and Automated Support</strong></h4> <p>Automation boosts \(C(t)\):</p> <ul> <li>If \(C(t)\gg R(t)\), \(\dot{V}(B,\dot{B})&lt;0\), system stable</li> </ul> <h4 id="v-spillover-effects-of-geopolitical-tensions"><strong>V. Spillover Effects of Geopolitical Tensions</strong></h4> <p>International conflicts push STEM talent to the U.S., \(R(t)\) spikes:</p> <ul> <li>If \(R(t)\gg C(t)\), \(\dot{V}(B,\dot{B})&gt;0\), temporary measures needed to boost \(C(t)\)</li> </ul> <blockquote> <h4 id="summary-1"><strong>Summary</strong></h4> <p>Recent discussions with immigration attorneys highlight the urgent need for clearer, more detailed coordination between USCIS and the Department of Labor (DOL). The surge in NIW petition filings is closely tied to factors such as big tech companies (e.g., Google and Amazon) halting PERM applications and the commencement of EB-2 Premium Processing in 2023, both of which have propelled NIW filings to new heights.</p> <p class="block-danger">To address this, USCIS and DOL should refine their division of responsibilities and share the workload more effectively, potentially allowing large tech employers to resume at least some PERM filings. After all, NIW petitions are self-petitions, intended to be initiated by the individuals themselves, rather than by companies treating employees as beneficiaries. Without reform, large tech–driven NIW submissions risk creating an unfair disadvantage for genuine self-petitioners and straining system capacity. Collaboration between USCIS and DOL is therefore vital to maintain both the integrity of the NIW process and a balanced workflow.</p> </blockquote> <h1 id="references">References</h1> <ol> <li>“2024 Presidential Election Polls: Harris vs. Trump,” <em>270toWin</em>, Oct. 2024. [Online]. Available: <a href="https://www.270towin.com/">https://www.270towin.com</a>. [Accessed: 15-Oct-2024].</li> <li>“STEM-Related Petition Trends: EB-2 and O-1A Categories Fact Sheet FY23,” <em>U.S. Citizenship and Immigration Services (USCIS)</em>, Oct. 2023. [Online]. Available: <a href="http://uscis.gov/">USCIS.gov</a>. [Accessed: 15-Oct-2024].</li> <li>“Green card: Decoding why Amazon &amp; Google suspended green card applications,” <em>The Economic Times</em>, May 2024. [Online]. Available: <a href="https://economictimes.indiatimes.com/">https://economictimes.indiatimes.com</a>. [Accessed: 15-Oct-2024].</li> </ol>]]></content><author><name></name></author><category term="informal"/><category term="law"/><category term="analysis"/><summary type="html"><![CDATA[Lyapunov Stability Analysis on USCIS Petitions.]]></summary></entry><entry><title type="html">Ezzy Job Finder 🕵️‍♂️ With Animated Visualizations</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/ezzy-job/" rel="alternate" type="text/html" title="Ezzy Job Finder 🕵️‍♂️ With Animated Visualizations"/><published>2024-05-01T00:32:13+00:00</published><updated>2024-05-01T00:32:13+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/ezzy-job</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/ezzy-job/"><![CDATA[<h2 id="introduction">Introduction</h2> <p>Job hunting is like online dating: it’s all about finding the right match before someone else swoops in. But instead of endlessly swiping (or scrolling), what if you could automate the process and get all the juicy details delivered to you on a silver platter? That’s the magic of web scraping, and today, we’re diving into building a job posting scraper with Python.</p> <p>Whether you’re a scraping newbie or an enthusiast looking to up your game, this guide will take you from zero to hero, one job listing at a time. By the end, you’ll have a fully functional tool that fetches the latest job opportunities and notifies you in real-time. Let’s go! 🚀</p> <h2 id="why-scraping">Why Scraping?🤔</h2> <p>Imagine waking up each morning with a fresh list of job opportunities—tailored to your preferences. No more manually sifting through job boards or missing out because you forgot to check. With a scraper:</p> <ul> <li><strong>Save Time</strong>: Automate repetitive searches.</li> <li><strong>Get Organized</strong>: Store job data neatly for analysis.</li> <li><strong>Stay Ahead</strong>: Receive real-time updates on the hottest listings.</li> </ul> <p>This tool isn’t just about automation—it’s about empowerment. You control the job search process while letting the script handle the tedious parts.</p> <h2 id="the-tech-stack">The Tech Stack</h2> <p>Here’s what powers our job scraper:</p> <ul> <li><strong>Python</strong>: The heart of the operation.</li> <li><strong>Undetected ChromeDriver</strong>: Bypasses pesky anti-bot measures by pretending to be a human.</li> <li><strong>BeautifulSoup &amp; lxml</strong>: Extracts meaningful data from HTML chaos.</li> <li><strong>Psycopg2</strong>: Talks to PostgreSQL, where we store all the data.</li> <li><strong>Telebot</strong>: Notifies you via Telegram, because who doesn’t love instant updates?</li> <li><strong>D3j</strong>: The beautiful and elegent part of visualization.</li> </ul> <h2 id="lets-build-it-">Let’s Build It 🚀</h2> <p>Below is a sequence diagram that represents the entire scrapping process.</p> <pre><code class="language-mermaid">
sequenceDiagram
    autonumber

    actor User

    participant Script as main()
    participant Notifier as TelebotNotifier
    participant DB as JobDatabase
    participant Browser as Browser
    participant Scraper as scrape_jobs()
    participant JobObj as Job

    User -&gt;&gt; Script: Run the script
    Script -&gt;&gt; Notifier: telebot_notifier.send_notification("Script started")
    Script -&gt;&gt; DB: db = JobDatabase()
    Script -&gt;&gt; Browser: browser = Browser()

    Script -&gt;&gt; Script: Prompt user for job keywords, locations, &amp; radius

    loop For each selected job_keyword
        Script -&gt;&gt; Script: Print "Searching for job keyword: ..."
        loop For each selected location_keyword
            Script -&gt;&gt; Script: Print "Searching in location: ..."
            Script -&gt;&gt; Scraper: scrape_jobs(db, browser, job_keyword, location_keyword, job_search_radius)

            Scraper -&gt;&gt; Browser: page_dom = browser.get_dom(pagination_url)
            Scraper -&gt;&gt; Browser: (Random sleeps, scrolling, etc.)
            alt If page_dom is None
                Scraper -&gt;&gt; Scraper: continue to next page
            else
                Scraper -&gt;&gt; Scraper: Parse job cards
                loop For each job card
                    Scraper -&gt;&gt; JobObj: job_obj = Job(job)
                    JobObj -&gt;&gt; JobObj: Extract job data&lt;br&gt;(title, company, date, etc.)

                    Scraper -&gt;&gt; DB: db.insert_record(record)
                end
            end
        end
    end

    Script -&gt;&gt; Browser: browser.close()
    Script -&gt;&gt; DB: db.close()
    Script -&gt;&gt; Notifier: telebot_notifier.send_notification("Script finished successfully")
    Script -&gt;&gt; User: End

</code></pre> <h3 id="step-1-setting-up-the-browser-">Step 1: Setting Up the Browser 🌐</h3> <p>Most job boards actively block bots. Undetected ChromeDriver ensures our scraper behaves like a real human. By randomizing user agents and browser behaviors, we stay under the radar.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">undetected_chromedriver</span> <span class="k">as</span> <span class="n">uc</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">Browser</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_browser</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_browser</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">user_agents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64)...</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">uc</span><span class="p">.</span><span class="nc">ChromeOptions</span><span class="p">()</span>
        <span class="n">options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">--user-agent=</span><span class="si">{</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">user_agents</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--window-size=1920,1080</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">--disable-blink-features=AutomationControlled</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">browser</span> <span class="o">=</span> <span class="n">uc</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">headless</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">browser</span>

    <span class="k">def</span> <span class="nf">get_dom</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">page_source</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error fetching URL </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div> <blockquote> <h5 id="why-using-delays">Why Using Delays?</h5> <p>Random pauses mimic natural browsing behavior and reduce the risk of detection. If you’re feeling fancy, you could even simulate mouse movements and clicks for added realism.</p> </blockquote> <h3 id="step-2-scraping-the-listings">Step 2: Scraping the Listings📋</h3> <p>Using <strong>lxml</strong>, we extract job titles, companies, locations, and descriptions from the page. It’s like finding the signal in the noise, but make it Pythonic.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">lxml</span> <span class="kn">import</span> <span class="n">etree</span> <span class="k">as</span> <span class="n">et</span>

<span class="k">class</span> <span class="nc">Job</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_element</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">job_element</span>

    <span class="k">def</span> <span class="nf">get_job_title</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">job</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="sh">"</span><span class="s">.//a[@class=</span><span class="sh">'</span><span class="s">job-title</span><span class="sh">'</span><span class="s">]/span/text()</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Not available</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">get_company_name</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">job</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="sh">"</span><span class="s">.//span[@class=</span><span class="sh">'</span><span class="s">company-name</span><span class="sh">'</span><span class="s">]/text()</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Not available</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">get_job_description</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">job</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="sh">"</span><span class="s">.//div[@class=</span><span class="sh">'</span><span class="s">job-description</span><span class="sh">'</span><span class="s">]/text()</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Not available</span><span class="sh">"</span>
</code></pre></div></div> <blockquote> <h5 id="quick-tip">Quick Tip</h5> <p>If the website structure changes, these XPath selectors may break. Regularly test your scraper to ensure compatibility.</p> </blockquote> <h3 id="step-3-storing-the-data-️">Step 3: Storing the Data 🗄️</h3> <p>With PostgreSQL, we can store job listings in a structured format for easy querying and analysis. This design allows you to track trends over time.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">psycopg2</span>
<span class="k">class</span> <span class="nc">JobDatabase</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span>
            <span class="n">dbname</span><span class="o">=</span><span class="sh">"</span><span class="s">jobs_db</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">create_table</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
            <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
                CREATE TABLE IF NOT EXISTS jobs (
                    id SERIAL PRIMARY KEY,
                    title TEXT,
                    company TEXT,
                    description TEXT,
                    scraped_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            </span><span class="sh">"""</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">insert_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
            <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
                INSERT INTO jobs (title, company, description)
                VALUES (%s, %s, %s)
            </span><span class="sh">"""</span><span class="p">,</span> <span class="n">job_data</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
</code></pre></div></div> <h4 id="step-4-notifications-via-telegram-">Step 4: Notifications via Telegram 📲</h4> <p>Who wouldn’t want their scraper to double as a personal assistant? With Telebot, get instant alerts about job postings on your Telegram.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">telebot</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="k">class</span> <span class="nc">TelebotNotifier</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bot_token</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">'</span><span class="s">TELEBOT_TOKEN</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">chat_id</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">'</span><span class="s">TELEBOT_CHAT_ID</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">telebot</span><span class="p">.</span><span class="nc">TeleBot</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bot_token</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_notification</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">bot</span><span class="p">.</span><span class="nf">send_message</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">chat_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to send notification: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h4 id="step-5-scraping-in-action-">Step 5: Scraping in Action 🎬</h4> <p>Now, we stitch it all together into a scraper that fetches job listings, stores them, and keeps you updated.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scrape_jobs</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">notifier</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://www.indeed.com/jobs?q=developer&amp;l=remote</span><span class="sh">"</span>
    <span class="n">page_source</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="nf">get_dom</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">et</span><span class="p">.</span><span class="nc">HTML</span><span class="p">(</span><span class="n">page_source</span><span class="p">)</span>
    <span class="n">job_elements</span> <span class="o">=</span> <span class="n">dom</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="sh">"</span><span class="s">//div[@class=</span><span class="sh">'</span><span class="s">job_seen_beacon</span><span class="sh">'</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">job_element</span> <span class="ow">in</span> <span class="n">job_elements</span><span class="p">:</span>
        <span class="n">job</span> <span class="o">=</span> <span class="nc">Job</span><span class="p">(</span><span class="n">job_element</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">job</span><span class="p">.</span><span class="nf">get_job_title</span><span class="p">()</span>
        <span class="n">company</span> <span class="o">=</span> <span class="n">job</span><span class="p">.</span><span class="nf">get_company_name</span><span class="p">()</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">job</span><span class="p">.</span><span class="nf">get_job_description</span><span class="p">()</span>

        <span class="n">db</span><span class="p">.</span><span class="nf">insert_record</span><span class="p">((</span><span class="n">title</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">description</span><span class="p">))</span>
        <span class="n">notifier</span><span class="p">.</span><span class="nf">send_notification</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">New Job: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> at </span><span class="si">{</span><span class="n">company</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processed: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> at </span><span class="si">{</span><span class="n">company</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nc">JobDatabase</span><span class="p">()</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="nc">Browser</span><span class="p">()</span>
    <span class="n">notifier</span> <span class="o">=</span> <span class="nc">TelebotNotifier</span><span class="p">()</span>

    <span class="nf">scrape_jobs</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">notifier</span><span class="p">)</span>

    <span class="n">browser</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="nf">quit</span><span class="p">()</span>
    <span class="n">db</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <h3 id="challenges-and-how-we-solved-them-">Challenges and How We Solved Them 🔧</h3> <h4 id="1-anti-bot-measures">1. Anti-Bot Measures</h4> <ul> <li>Randomized user agents, browser options, and delays.</li> <li>Used <strong>Undetected ChromeDriver</strong> to blend in with regular users.</li> </ul> <h4 id="2-data-duplication">2. Data Duplication</h4> <p>Before inserting data into the database, ensure no duplicate entries exist by querying for existing job titles.</p> <blockquote> <h5 id="tips">Tips</h5> <p>Prevent duplicate entries by creating unique constraints in your database:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">jobs</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">unique_job</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">company</span><span class="p">);</span>
</code></pre></div> </div> </blockquote> <h4 id="3-dynamic-web-pages">3. Dynamic Web Pages</h4> <p>By using browser.get_dom with Selenium, we ensure the entire page loads before scraping.</p> <h3 id="ethical-web-scraping-">Ethical Web Scraping 🌐</h3> <p>Web scraping is powerful, but it comes with responsibilities:</p> <ol> <li><strong>Follow Terms of Service</strong>: Always check the website’s rules before scraping.</li> <li><strong>Be Polite</strong>: Use delays to avoid overwhelming servers.</li> <li><strong>Respect Privacy</strong>: Never scrape or use personal data without consent.</li> </ol> <h2 id="visualizations">Visualizations</h2> <p>Visualization is a key part of making the data more accessible and actionable. In this project, I leveraged D3.js, a JavaScript library for producing dynamic, interactive data visualizations in the browser. The two core visualizations include:</p> <ol> <li>GeoMap: Highlights job posting activity by region.</li> <li>Word Cloud: Showcases the frequency of company names based on job postings.</li> </ol> <p>These visualizations transform raw, tabular job data into visually intuitive representations, making it easier to uncover trends and insights.</p> <h3 id="geomap-visualizing-regional-job-trends-️">GeoMap: Visualizing Regional Job Trends 🗺️</h3> <p>The GeoMap provides a regional overview of job posting activity, helping users identify hotspots for job opportunities.</p> <h4 id="how-it-was-built">How It Was Built</h4> <ol> <li><strong>GeoJSON Data</strong>: <ul> <li>A GeoJSON file containing the geographical coordinates of U.S. states was used as the base map.</li> <li>Each region was linked with job counts processed from the PostgreSQL database.</li> </ul> </li> <li><strong>D3.js Mapping</strong>: <ul> <li>D3’s <code class="language-plaintext highlighter-rouge">geoPath</code> function was used to project the GeoJSON data onto an SVG canvas.</li> <li>A choropleth color scale (<code class="language-plaintext highlighter-rouge">d3.scaleSequential</code>) was applied, where darker shades represent regions with higher job posting activity.</li> </ul> </li> <li><strong>Interactive Tooltips</strong>: <ul> <li>When hovering over a state, the tooltip displays the number of job postings in that region.</li> </ul> </li> </ol> <div id="chart-job-map"></div> <script src="https://d3js.org/topojson.v3.min.js"></script> <script src="/ps-cv/assets/js/chart/chart-job-map.js" defer=""></script> <script>document.addEventListener("DOMContentLoaded",function(){"function"==typeof renderJobMap?renderJobMap("#chart-job-map","../assets/json/formatted.csv","Job Posting Visualization"):console.error("Function 'renderJobMap' is not defined.")});</script> <h3 id="word-cloud">Word Cloud</h3> <p>The Word Cloud focuses on employer frequency, visually showing which companies are posting the most jobs.</p> <h4 id="how-it-was-built-1">How It Was Built</h4> <ol> <li> <p><strong>Data Preprocessing</strong>:</p> <ul> <li>Job data was grouped by company name, with each name assigned a frequency count.</li> <li>Special characters (+) in company names were replaced with spaces for readability.</li> </ul> </li> <li> <p><strong>Dynamic Updates</strong>:</p> <ul> <li>The word cloud is connected to a scrubber widget that allows users to cycle through timestamps of job postings.</li> <li>As the scrubber moves, the word cloud dynamically updates to reflect the most active companies at that time.</li> </ul> </li> <li> <p><strong>D3 Cloud Layout</strong>:</p> <ul> <li>Word sizes were scaled using <code class="language-plaintext highlighter-rouge">Math.sqrt(frequency) * 20</code>, ensuring more frequent companies are visually prominent.</li> <li>Words were randomly rotated for visual variety.</li> </ul> </li> </ol> <div id="chart-word-cloud"></div> <script src="https://cdn.jsdelivr.net/npm/d3-cloud@1.2.7/build/d3.layout.cloud.min.js"></script> <script src="/ps-cv/assets/js/chart/chart-word-cloud.js" defer=""></script> <script>document.addEventListener("DOMContentLoaded",function(){"function"==typeof renderWordCloudChart?renderWordCloudChart("#chart-word-cloud"):console.error("Function 'renderWordCloudChart' is not defined.")});</script> <h2 id="conclusion-">Conclusion 🎉</h2> <p>And there you have it—a full-fledged Python scraper to tame the chaotic job market! This script not only fetches job postings but also transforms them into actionable insights, all while notifying you in real-time.</p> <p>So, what’s next? Scale it up to scrape multiple job boards, build analytics dashboards, or even integrate with a resume uploader for semi-automated job applications. Happy scraping!</p>]]></content><author><name></name></author><category term="automation"/><category term="data"/><category term="code"/><summary type="html"><![CDATA[Automate Job Postings Scraper with Python and elegent visualization using d3j]]></summary></entry><entry><title type="html">ML Enablement for Old Homelab</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/quiet-cool/" rel="alternate" type="text/html" title="ML Enablement for Old Homelab"/><published>2024-04-14T04:30:00+00:00</published><updated>2024-04-14T04:30:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/quiet-cool</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/quiet-cool/"><![CDATA[<h2 id="reading-time"><strong>Reading Time</strong></h2> <p>About as long as it takes your GPU fan to spin up to 100% and then ease back down as it ponders your newfound genius.</p> <hr/> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <video src="/ps-cv/assets/img/quietCool/ANNExplanationScene.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" autoplay="" controls=""/> </figure> </div> </div> <div class="caption"> A VIDEO OF THE MAGIC BEHIND QUIET COOL </div> <h2 id="prerequisites"><strong>Prerequisites</strong></h2> <p>Before diving headlong into this GPU fan-control escapade, you’ll want to be comfortable with:</p> <ul> <li><strong>Basic Python &amp; Flask</strong>: Enough to spin up a simple web server and handle a few REST calls.</li> <li><strong>System Management Tools (e.g., ipmitool)</strong>: Know how to read fan speeds or set them via your hardware interface.</li> <li><strong>Linux Command Line Kung Fu</strong>: You don’t need to be a grandmaster, but some CLI familiarity never hurts.</li> <li><strong>A GPU in a Server</strong>: Preferably one that can handle a bit of experimental tinkering as you dial in those fan speeds.</li> </ul> <p><a href="https://flask.palletsprojects.com/en/stable/">Need a Python web framework refresher? Here’s a helpful Flask guide.</a></p> <h2 id="introduction"><strong>Introduction</strong></h2> <blockquote> <p><strong>The Big Chill</strong></p> <p>Picture this: You’ve got a GPU humming away inside your old faithful Dell PowerEdge R720—hardware that’s practically a fossil. Its default fan settings? Rudimentary at best. When the GPU gets hot, the fans go full throttle, threatening to turn your homelab into a wind tunnel. There’s no fancy vendor-provided fan curve, no quiet mode—just a binary choice between “whisper-quiet but toasty” or “cool but screaming like a banshee.”</p> </blockquote> <p>Enter <strong>Quiet Cool</strong>, a Python/Flask-based microservice that reads GPU temperatures, predicts optimal fan speeds with machine learning, and commands your fans like a serene maestro conducting a gentle breeze. You get temperature sanity and acoustic tranquility—no more wind-tunnel weekends.</p> <hr/> <h2 id="why-bother-the-problem--the-vision"><strong>Why Bother? The Problem &amp; The Vision</strong></h2> <h3 id="the-problem"><strong>The Problem</strong></h3> <p>Your server’s default fan logic is about as subtle as a sledgehammer. You’re either cooking your GPU or listening to a jet engine test run. Neither scenario is ideal.</p> <h3 id="the-vision"><strong>The Vision</strong></h3> <p>Quiet Cool serves as the missing link—a dynamic fan control system that fine-tunes fan speeds to keep your GPU within a comfortable thermal range without making your ears bleed. Think of it as your personal HVAC technician: it juggles temperature and noise constraints to find that sweet spot of equilibrium.</p> <hr/> <h2 id="architecture-overview-under-the-hood"><strong>Architecture Overview: Under the Hood</strong></h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/quietCool/diagram-480.webp 480w,/ps-cv/assets/img/quietCool/diagram-800.webp 800w,/ps-cv/assets/img/quietCool/diagram-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/quietCool/diagram.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Mechanisms" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Diagram of Adaptive Fan Speed Control: Balancing GPU Temperature and Noise with Machine Learning and Fallback Safety Mechanisms </div> <h3 id="diagram-breakdown-adaptive-fan-speed-control-logic"><strong>Diagram Breakdown: Adaptive Fan Speed Control Logic</strong></h3> <p>The system’s adaptive fan speed control mechanism is illustrated in the diagram below. This logic leverages real-time GPU temperature data, a machine learning-based prediction model, and fallback safety mechanisms to maintain thermal stability and acoustic optimization.</p> <h4 id="key-components-and-workflow"><strong>Key Components and Workflow</strong></h4> <ol> <li>GPU Machine: <ul> <li>Continuously monitors GPU temperatures and relays this data to the Fan Control Server via the sendGPUTemperature() function.</li> <li>Serves as the primary source of real-time environmental data.</li> </ul> </li> <li>Fan Control Server: <ul> <li>Operates as the brain of the system, processing temperature data and orchestrating fan speed commands.</li> <li>Implements two stages of control logic: <ul> <li>Initial Control Logic (useInitialControlLogic): Applied during the first 100 iterations to ensure basic safety and prevent overheating using predefined thresholds.</li> <li>Prediction-Based Logic (predictFanSpeed): Once sufficient data is gathered (after 100 iterations), the server predicts optimal fan speeds using a machine learning model and validates these predictions with validateFanSpeed() to ensure reliability.</li> </ul> </li> <li>Logs all temperature and fan speed data into Data Storage, enabling periodic model retraining for improved accuracy.</li> <li>Sends precise fan speed commands to the iDRAC module using sendFanSpeedCommand().</li> </ul> </li> <li>iDRAC Module: <ul> <li>Acts as an intermediary between the server and the physical fan hardware.</li> <li>Receives fan speed commands and executes them by instructing the Fans Module to adjust speeds via changeFanSpeed().</li> </ul> </li> <li>Fans Module: <ul> <li>Physically adjusts fan speeds to regulate the GPU’s temperature based on the commands received from iDRAC.</li> </ul> </li> <li>Data Storage: <ul> <li>Logs operational data (e.g., temperature, fan speed, predictions) for future analysis and continuous model improvement.</li> </ul> </li> </ol> <h4 id="safety-and-adaptability"><strong>Safety and Adaptability</strong></h4> <ol> <li>If the prediction-based logic fails validation or the iteration count is below 100, a fallback mechanism (useFallbackLogic()) ensures safe fan operations, preventing system instability.</li> <li>Machine learning models continuously adapt, balancing noise levels and thermal performance by learning from the recorded data.</li> </ol> <h3 id="1-flask-server--rest-api"><strong>1. Flask Server &amp; REST API</strong></h3> <p>A lightweight Flask server listens for GPU temperature updates. POST your GPU’s current temperature to <code class="language-plaintext highlighter-rouge">/gpu-temperature</code>, and the server responds with a recommended fan speed.</p> <h3 id="2-temperature-monitoring-script"><strong>2. Temperature Monitoring Script</strong></h3> <p>A shell script (<code class="language-plaintext highlighter-rouge">monitor_gpu_temp.sh</code>) runs on the machine hosting the GPU. Every 10 seconds or so, it checks the GPU temperature and posts it to the Flask server. It’s like a temperature courier, passing urgent “I’m hot” notes to the server.</p> <h3 id="3-initial-control-logic"><strong>3. Initial Control Logic</strong></h3> <p>Before machine learning enters the fray, we start simple with a piecewise function (old-fashioned if-then-else) to set fan speeds based on temperature thresholds. Under 40°C? Gentle breeze. Above 55°C? Kick it up. This baseline logic ensures we never fry the GPU while we gather training data for the ML model.</p> <h3 id="4-machine-learning-model"><strong>4. Machine Learning Model</strong></h3> <p>After collecting enough data from the baseline runs, we feed it into a machine learning model. This model predicts fan speeds and uses a custom loss function that penalizes excessive noise and unsafe temperatures. Over time, the model learns to keep the GPU cool without triggering hurricane-force fans.</p> <hr/> <h2 id="the-math--the-madness">The Math &amp; The Madness</h2> <h3 id="1-initial-control-logic"><strong>1. Initial Control Logic</strong></h3> <p>Before we involve machine learning, we rely on a piecewise (rule-based) approach to ensure the GPU doesn’t overheat while we collect data. For example:</p> \[F_{\text{init}}(T) = \begin{cases} 10\%, &amp; T &lt; 40^\circ\text{C}, \\[6pt] 30\%, &amp; 40^\circ\text{C} \le T &lt; 55^\circ\text{C}, \\[6pt] 50\%, &amp; T \ge 55^\circ\text{C} \end{cases}\] <p>This basic logic logs pairs of \((T_{\text{GPU}}, \text{fan_speed})\) . Those pairs become our initial training samples for the ML model.</p> <h3 id="2-moving-to-a-smarter-model"><strong>2. Moving to a Smarter Model</strong></h3> <p>We introduce a neural network that, given a temperature , predicts an <strong>optimal fan speed</strong>. However, “optimal” here also depends on noise constraints, so we must include noise and temperature considerations in our training objective (loss function). The network must learn that:</p> <ol> <li>Excessive fan speeds can mean high noise.</li> <li>Too-low fan speeds can mean high temperatures.</li> </ol> <p><strong>Key Insight</strong>: The final output of our neural network is not just a single fan speed. In the code example, we produce a 3-component vector $\bigl(s, n, t\bigr)$:</p> <ul> <li> <p>\(s\) = predicted fan speed,</p> </li> <li> <p>\(v\) = predicted noise level,</p> </li> <li> <p>\(n\) = predicted temperature,</p> </li> </ul> <p>so the network can self-consistently learn to balance these outputs.</p> <h3 id="3-modeling-noise-from-fan-speed"><strong>3. Modeling Noise From Fan Speed</strong></h3> <p>Noise often increases with fan RPM in a roughly logarithmic manner. If we know a reference noise level $N_0$ at reference \(RPM_0\) , we can approximate noise $N_1$ at \(RPM_1\) with:</p> \[N_1 \approx N_0 + K \cdot \log\!\Bigl(\frac{\text{RPM}_1}{\text{RPM}_0}\Bigr)\] <p>where \(K\) is some empirical constant derived from mechanical/fan acoustic data. This gives a <strong>differentiable</strong> function linking fan speed to noise. Over time, you can refine this model with real measurements of noise vs. RPM.</p> <p><strong>Note:</strong> If you can query actual RPM via IPMI (e.g., <code class="language-plaintext highlighter-rouge">ipmitool sensor | grep Fan</code>) and measure noise directly, you can fit a more accurate function. In practice, the model can treat the predicted fan speed (\(s\%\)) as proportional to \(RPM\) , or you can store actual readings for finer control.</p> <h3 id="4-modeling-temperature-from-fan-speed"><strong>4. Modeling Temperature From Fan Speed</strong></h3> <p>Temperature is trickier. Higher fan speeds improve cooling, but the relationship may be nonlinear, depending on system load, ambient temperature, etc. A simple approach:</p> <ol> <li>Collect data pairs \(\bigl(f, T_{\text{GPU}}\bigr)\)</li> <li>Fit a regression \(T(f)\) that, for a given fan speed \(f\) , estimates GPU temperature \(T_{GPU}\).</li> </ol> <p>Even a crude linear or polynomial model is better than nothing. As you gather more data, refine your temperature model.</p> <h3 id="5-neural-network-structure"><strong>5. Neural Network Structure</strong></h3> <ol> <li><strong>Inputs</strong>: GPU temperature $T$.</li> <li><strong>Hidden Layer</strong>: Dense layer (size 128, ReLU activation).</li> <li><strong>Outputs</strong>: A 3-component vector \(\bigl(s, n, t\bigr)\):</li> </ol> \[f(T) = \bigl(s,\,n,\,t\bigr)\] <ul> <li>\(s\) = predicted fan speed (as a percentage or a suitable scale).</li> <li>\(n\) = predicted noise level (dB).</li> <li>\(t\) = predicted temperature (°C).</li> </ul> <p>In pseudo-math form:</p> \[f(T)= W_2 \,\sigma\!\bigl(W_1 \,T + b_1\bigr) \cdot b_2\] <p>where $\sigma$ is the ReLU activation, and $W_1, b_1, W_2, b_2$  are trainable weights.</p> <h3 id="6-revised-custom-loss-function"><strong>6. Revised Custom Loss Function</strong></h3> <p>Our custom loss function must capture three things:</p> <ol> <li><strong>Fan Speed MSE</strong>: We compare the predicted fan speed to the <em>true/observed</em> fan speed \(\hat{s}\) (initially from the rule-based logic) to ensure continuity with past data:</li> </ol> \[\mathcal{L}_{\text{fan_speed}} = \frac{1}{N}\sum{i=1}^{N} \bigl(\hat{s}_i - s_i\bigr)^2\] <ol> <li><strong>Noise Penalty: We penalize noise beyond some threshold \(\text{NOISE_THRESHOLD}\) , e.g., 80 dB:</strong></li> </ol> \[\text{noise_penalty}_i = \begin{cases} \alpha_N \,\bigl(n_i - 80\bigr)^2, &amp; n_i &gt; 80,\\ 0, &amp; \text{otherwise} \end{cases}\] <p>This encourages predictions that keep noise under 80 dB.</p> <ol> <li><strong>Temperature Penalty: We penalize predicted temperatures above some safe threshold \(\text{TEMP_THRESHOLD}\) , e.g., 85°C:</strong></li> </ol> \[\text{temp_penalty}_i = \begin{cases} \alpha_T \,\bigl(t_i - 85\bigr)^2, &amp; t_i &gt; 85,\\ 0, &amp; \text{otherwise} \end{cases}\] <p>Putting it all together:</p> \[\mathcal{L} = \underbrace{\frac{1}{N}\sum_{i=1}^{N} (\hat{s}_i - s_i)^2}_{\text{fan_speed MSE}} \;+\; \frac{1}{N}\sum_{i=1}^{N}\Bigl[\text{noise_penalty}_i + \text{temp_penalty}_i\Bigr]\] <h3 id="7-fan-speed-decision-logic"><strong>7. Fan-Speed Decision Logic</strong></h3> <p>Even after training, we keep a fallback check. When a new temperature arrives:</p> <ol> <li><strong>Model Prediction</strong>: \(\bigl(s,\,n,\,t\bigr) = f(T)\)</li> <li><strong>Validity Check:</strong></li> </ol> <p><strong>We have a piecewise “safe range” for fan speed:</strong></p> \[\text{is_valid_fan_speed}(T, s)= \begin{cases}\text{True}, &amp; \text{if } T&lt;40 \implies 10\%\le s \le 30\%,\\\text{True}, &amp; \text{if } 40\le T&lt;50 \implies 30\%\le s \le 50\%,\\\dots &amp; \dots \\\text{False}, &amp; \text{otherwise}\end{cases}\] <p>If \(s\) is outside this range, revert to the simpler piecewise function \(F_{\text{init}}(T)\).</p> <ol> <li><strong>Set Fan Speed</strong>: Whichever final speed we settle on gets applied via IPMI.</li> </ol> <p><strong>Hence, the chosen fan speed is:</strong></p> \[F(t)= \begin{cases} s, &amp; \text{if is_valid_fan_speed}(T, s)=\text{True}\\ F{\text{init}}(T), &amp; \text{otherwise} \end{cases}\] <h3 id="8-periodic-retraining"><strong>8. Periodic Retraining</strong></h3> <ol> <li><strong>Data Collection</strong>: Each time we set a fan speed , we log:</li> </ol> \[\Bigl(T(t),\,F(t),\,\text{RPM}(t),\,\text{any noise measurements}\Bigr)\] <ol> <li><strong>Augment</strong>: Possibly estimate noise $\hat{n}(t)$ using the noise model, or measure it.</li> <li> <p><strong>Retrain Condition</strong>: Every time we accumulate, say, 10 new samples (or some threshold), we update the dataset \(\{(T_i, \hat{s}_i, \hat{n}_i, \hat{t}i)\}\) and retrain the network by minimizing:</p> \[\min_ \mathcal{L}\Bigl(\{f(T_i)\}, \{\hat{\mathbf{y}}_i\}\Bigr)\] </li> <li><strong>Iterate</strong>: Over time, the model learns more accurate temperature/noise relationships, refining predictions.</li> </ol> <h3 id="putting-it-all-together"><strong>Putting It All Together</strong></h3> <ol> <li><strong>Baseline</strong>: Use a simple piecewise fan-speed logic \(\bigl(F_{\text{init}}(T)\bigr)\) to gather initial data.</li> <li><strong>Train</strong> a neural network that outputs with a custom loss balancing fan-speed accuracy, noise penalty, and temperature penalty.</li> <li><strong>Runtime</strong>: For each new GPU temperature:</li> <li>Predict \(\bigl(s, n, t\bigr) = f(T)\).</li> <li>Validate $s$ via <code class="language-plaintext highlighter-rouge">is_valid_fan_speed()</code>.</li> <li>Either accept $s$ or fallback to the piecewise rule.</li> <li>Log data; periodically retrain.</li> </ol> <p>This architecture ensures we keep the system safe (by falling back if predictions go wild) while gradually shifting control toward an ML-driven approach. Over enough iterations, you get a <strong>data-informed fan-speed controller</strong> that strikes an improved balance between <strong>noise</strong> and <strong>temperature</strong> compared to naive, fixed thresholds.</p> <h2 id="implementation-details"><strong>Implementation Details</strong></h2> <h3 id="training-procedure"><strong>Training Procedure</strong></h3> <ol> <li><strong>Data Collection</strong>: Run the baseline piecewise logic for a while, logging (temperature, fan speed, RPM) samples. Estimate noise from RPM using the given formula and store these values.</li> <li><strong>Modeling Functions</strong>: Fit functions for \(T(f_{\text{pred}})\) and \(N(f_{\text{pred}})\). Even a simple regression can serve as a starting point.</li> <li><strong>Integrate into Loss</strong>: Implement the custom loss function, ensuring \(T(f_{\text{pred}})\) and \(N(f_{\text{pred}})\) are differentiable with respect to model parameters (if using a neural net, for example).</li> <li><strong>Train the Model</strong>: Use gradient-based optimization to minimize the combined loss. Over iterations, the model learns to set fan speeds that strike a better balance than the naive piecewise logic.</li> </ol> <hr/> <blockquote> <h5 id="disclaimer-experimental-territory"><strong>Disclaimer Experimental Territory</strong></h5> <p class="block-warning">No warranties, no promises. If your fan control goes haywire or your GPU gets too toasty, remember this is all very much a DIY affair. Monitor closely, test slowly, and proceed at your own risk.</p> </blockquote> <hr/> <h2 id="setting-it-up-from-git-clone-to-gentle-breeze"><strong>Setting It Up: From Git Clone to Gentle Breeze</strong></h2> <h3 id="1-clone-the-repo--setup-environment"><strong>1. Clone the Repo &amp; Setup Environment</strong></h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/yourusername/quiet-cool.git
<span class="nb">cd </span>quiet-cool
python3 <span class="nt">-m</span> venv venv
<span class="nb">source </span>venv/bin/activate
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div> <h3 id="2-run-the-server"><strong>2. Run the Server</strong></h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python fan_control_server.py
</code></pre></div></div> <h3 id="3-monitor-gpu-temp--post-data"><strong>3. Monitor GPU Temp &amp; Post Data</strong></h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./monitor_gpu_temp.sh
</code></pre></div></div> <hr/> <h2 id="source-code">Source Code:</h2> <h3 id="1-monitor_gpu_tempsh"><strong>1. monitor_gpu_temp.sh</strong></h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># monitor_gpu_temp.sh: Script to monitor GPU temperature and send it to a remote machine</span>

<span class="nv">REMOTE_ADDRESS</span><span class="o">=</span><span class="s2">"http://your_flask_server:23333"</span>  <span class="c"># Replace with your remote machine's address</span>

get_gpu_temp<span class="o">()</span> <span class="o">{</span>
    nvidia-smi <span class="nt">--query-gpu</span><span class="o">=</span>temperature.gpu <span class="nt">--format</span><span class="o">=</span>csv,noheader,nounits
<span class="o">}</span>

<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">TEMP</span><span class="o">=</span><span class="si">$(</span>get_gpu_temp<span class="si">)</span>
    <span class="nb">echo</span> <span class="s2">"GPU Temperature: </span><span class="nv">$TEMP</span><span class="s2">°C"</span>
    curl <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s2">"temperature=</span><span class="nv">$TEMP</span><span class="s2">"</span> <span class="nv">$REMOTE_ADDRESS</span>/gpu-temperature
    <span class="nb">sleep </span>10
<span class="k">done</span>
</code></pre></div></div> <h3 id="2-fan_control_serverpy"><strong>2. fan_control_server.py</strong></h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pickle</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="n">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="n">IP_ADDRESS</span> <span class="o">=</span> <span class="sh">"</span><span class="s">10.10.10.10</span><span class="sh">"</span>  <span class="c1"># Replace with your iDrac address
</span><span class="n">USERNAME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">idaracusername</span><span class="sh">"</span>             <span class="c1"># Replace with your username
</span><span class="n">PASSWORD</span> <span class="o">=</span> <span class="sh">"</span><span class="s">idracpassword</span><span class="sh">"</span>           <span class="c1"># Replace with your password
</span>
<span class="c1"># Configuration files or environment variables should be used for these settings
</span><span class="n">DATA_FILE</span> <span class="o">=</span> <span class="sh">'</span><span class="s">gpu_fan_data.csv</span><span class="sh">'</span>
<span class="n">MODEL_FILE</span> <span class="o">=</span> <span class="sh">'</span><span class="s">fan_speed_model.h5</span><span class="sh">'</span>
<span class="n">LOG_FILE</span> <span class="o">=</span> <span class="sh">'</span><span class="s">training.log</span><span class="sh">'</span>
<span class="n">ITERATION_FILE</span> <span class="o">=</span> <span class="sh">'</span><span class="s">iteration_count.pkl</span><span class="sh">'</span>

<span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">training_status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">No training done yet</span><span class="sh">"</span>
<span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Logging configuration
</span><span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="sh">'</span><span class="s">%(asctime)s %(levelname)s: %(message)s</span><span class="sh">'</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">logging</span><span class="p">.</span><span class="nc">FileHandler</span><span class="p">(</span><span class="n">LOG_FILE</span><span class="p">),</span>
    <span class="n">logging</span><span class="p">.</span><span class="nc">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Custom loss function
</span><span class="k">def</span> <span class="nf">custom_loss</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">NOISE_THRESHOLD</span> <span class="o">=</span> <span class="mf">80.0</span>
    <span class="n">TEMP_THRESHOLD</span> <span class="o">=</span> <span class="mf">85.0</span>
    <span class="n">NOISE_PENALTY</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">TEMP_PENALTY</span> <span class="o">=</span> <span class="mf">20.0</span>

    <span class="n">fan_speed_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="nf">square</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">noise_penalty</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">NOISE_THRESHOLD</span><span class="p">,</span> <span class="n">NOISE_PENALTY</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="nf">square</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">NOISE_THRESHOLD</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">temp_penalty</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">TEMP_THRESHOLD</span><span class="p">,</span> <span class="n">TEMP_PENALTY</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="nf">square</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">TEMP_THRESHOLD</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fan_speed_loss</span> <span class="o">+</span> <span class="n">tf</span><span class="p">.</span><span class="nf">reduce_mean</span><span class="p">(</span><span class="n">noise_penalty</span> <span class="o">+</span> <span class="n">temp_penalty</span><span class="p">)</span>

<span class="c1"># Build model
</span><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">input_shape</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nc">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="sh">'</span><span class="s">relu</span><span class="sh">'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_shape</span><span class="p">,)),</span>
        <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nc">Dense</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="sh">'</span><span class="s">adam</span><span class="sh">'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">custom_loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="c1"># Load model if available
</span><span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">MODEL_FILE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">MODEL_FILE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">MODEL_FILE</span><span class="p">,</span> <span class="n">custom_objects</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">custom_loss</span><span class="sh">'</span><span class="p">:</span> <span class="n">custom_loss</span><span class="p">})</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error loading model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Load data
</span><span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error loading data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">fan_speed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">noise_level</span><span class="sh">'</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">fan_speed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">noise_level</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># Load iteration count
</span><span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">ITERATION_FILE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">ITERATION_FILE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">ITERATION_FILE</span><span class="p">,</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">iteration_file</span><span class="p">:</span>
            <span class="n">iteration_count</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">iteration_file</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error loading iteration count: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Train model function
</span><span class="k">def</span> <span class="nf">train_model</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">model</span><span class="p">,</span> <span class="n">training_status</span><span class="p">,</span> <span class="n">data</span>
    <span class="n">training_status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Training in progress</span><span class="sh">"</span>
    <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">training_status</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">]].</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="sh">'</span><span class="s">fan_speed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">noise_level</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">]].</span><span class="n">values</span>

    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nf">build_model</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">MODEL_FILE</span><span class="p">)</span>
    <span class="n">training_status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Training completed successfully</span><span class="sh">"</span>
    <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">training_status</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">set_fan_speed</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
    <span class="c1"># Convert the speed to a two-digit hexadecimal string
</span>    <span class="n">hex_speed</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">speed</span><span class="si">:</span><span class="mi">02</span><span class="n">x</span><span class="si">}</span><span class="sh">"</span>

    <span class="c1"># Create the command
</span>    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">ipmitool</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">-I</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lanplus</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">-H</span><span class="sh">"</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">-U</span><span class="sh">"</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">-P</span><span class="sh">"</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">],</span>
        <span class="sh">"</span><span class="s">raw</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">0x30</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0x30</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0x02</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">0xff</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">0x</span><span class="si">{</span><span class="n">hex_speed</span><span class="si">}</span><span class="sh">"</span>
    <span class="p">]</span>

    <span class="c1"># Execute the command
</span>    <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Fan speed set to </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Fan speed set to </span><span class="si">{</span><span class="n">speed</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/gpu-temperature</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">gpu_temperature</span><span class="p">():</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Received GPU Temperature: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s">°C</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">model</span><span class="p">,</span> <span class="n">iteration_count</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">:</span> <span class="n">IP_ADDRESS</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span> <span class="n">USERNAME</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span> <span class="n">PASSWORD</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
        <span class="c1"># Predict the fan speed using the model
</span>        <span class="n">predicted_speed</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([[</span><span class="n">temp</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fan_speed</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">predicted_speed</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">is_valid_fan_speed</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">fan_speed</span><span class="p">):</span>
            <span class="n">fan_speed</span> <span class="o">=</span> <span class="nf">initial_control_logic</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fan_speed</span> <span class="o">=</span> <span class="nf">initial_control_logic</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="c1"># Set fan speed
</span>    <span class="nf">set_fan_speed</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fan_speed</span><span class="p">)</span>

    <span class="c1"># Collect and save data
</span>    <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span> <span class="sh">'</span><span class="s">fan_speed</span><span class="sh">'</span><span class="p">:</span> <span class="n">fan_speed</span><span class="p">}</span>
    <span class="k">global</span> <span class="n">data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">new_data</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">logging</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Data saved: </span><span class="si">{</span><span class="n">new_data</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Train model periodically
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">train_model</span><span class="p">()</span>

    <span class="k">return</span> <span class="sh">"</span><span class="s">OK</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">initial_control_logic</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">30</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">50</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">70</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">80</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">100</span>

<span class="k">def</span> <span class="nf">is_valid_fan_speed</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">fan_speed</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">30</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">30</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">50</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">50</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">70</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">70</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">80</span>
    <span class="k">elif</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">80</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">90</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">90</span> <span class="o">&lt;=</span> <span class="n">fan_speed</span> <span class="o">&lt;=</span> <span class="mi">100</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">'</span><span class="s">0.0.0.0</span><span class="sh">'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">23333</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error starting Flask app: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></div> <h2 id="limitations--future-directions"><strong>Limitations &amp; Future Directions</strong></h2> <ul> <li>Improved Modeling: Current noise and temperature models are approximations. Future work could involve more accurate acoustic measurements and detailed thermal models.</li> <li>User Modes &amp; GUIs: In the future, imagine a web interface letting you toggle “Quiet Mode” or “Performance Mode.”</li> <li>Hardware Compatibility: For now, tested on a Dell PowerEdge R720. With refinements, we could support a wide range of hardware, or even integrate sensor fusion from multiple data points.</li> </ul>]]></content><author><name></name></author><category term="Machine"/><category term="Learning"/><category term="code"/><category term="IoT"/><category term="ML"/><summary type="html"><![CDATA[Charge Grandpa's Machine w/ Artificial Neural Network]]></summary></entry><entry><title type="html">Monitor Your Homelab Using Grafana + Prometheus</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/observability/" rel="alternate" type="text/html" title="Monitor Your Homelab Using Grafana + Prometheus"/><published>2024-04-01T15:06:00+00:00</published><updated>2024-04-01T15:06:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/observability</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/observability/"><![CDATA[<h2 id="prelude-tired-of-bi-tools-try-grafana">Prelude: Tired of BI Tools? Try Grafana!</h2> <p>Are you fed up with the same old BI tools like Tableau and PowerBI? Then, welcome to the Grafana fan club—a refreshing twist in the world of analytics and monitoring! Grafana isn’t just any platform; it’s an open-source wonder that lets you query, visualize, alert on, and understand your metrics, no matter their hiding spots. Dive into creating, exploring, and sharing dashboards that not only look cool but also make you the hero of data-driven decision-making. Here’s why Grafana stands out from the crowd:</p> <ul> <li> <p><strong>Open Source Magic</strong>: Wave goodbye to those pricey subscriptions! Grafana is open-source, meaning you can keep your wallet happy and your data happier. And let’s be honest, in the world of UI/UX design, Tableau still feels like it’s using a map to find the ‘start’ button.</p> </li> <li> <p><strong>Community Strength</strong>: Ever feel lonely in the data jungle? Not with Grafana! Join a community brimming with enthusiasts eager to lend a hand, share a plugin, or offer a data-driven shoulder to cry on.</p> </li> <li> <p><strong>Plugin Paradise</strong>: Need more bells and whistles? Grafana’s robust library of plugins is like a Swiss Army knife for your data—always ready to extend your capabilities.</p> </li> <li> <p><strong>Diverse Data Sources</strong>: Whether it’s Graphite, Prometheus, InfluxDB, or Elasticsearch, Grafana speaks fluent data from nearly any source you can throw at it.</p> </li> <li> <p><strong>Alert Like a Pro</strong>: With Grafana’s sophisticated alerting system, you can set alerts that make even the most stoic data sit up and take notice.</p> </li> </ul> <p>Ready to break up with your old BI tools? Grafana is your new data-soulmate waiting to sweep you off your feet!</p> <h2 id="grafana-a-journey-from-zero-to-hero">Grafana: A Journey From Zero to Hero</h2> <p>Aight folks, let’s start preparing for the Grafana journey. We’ll be covering the following topics:</p> <ul> <li><strong>Getting Started</strong>: Installation, setup, and configuration of Grafana.</li> <li><strong>Data Sources</strong>: Connecting Grafana to various data sources.</li> <li><strong>Dashboards</strong>: Creating and customizing dashboards.</li> <li><strong>Plugins</strong>: Extending Grafana’s functionality with plugins.</li> <li><strong>Alerting</strong>: Setting up alerts for your data.</li> </ul> <h4 id="getting-started">Getting Started</h4> <p>Grafana is a breeze to install and set up. You can choose from various installation methods, including Docker, RPM/DEB packages, and even cloud services like AWS and Azure. Once you’ve installed Grafana, you can access it via your browser and start configuring it to your heart’s content. Here is a quick guide to get you started: <a href="https://grafana.com/docs/grafana/latest/installation/">Grafana Installation Guide</a>.<strong>If you are really in a hurry and want to get started right away before reading the installation guide, you can use the following Docker command to get Grafana up and running: <code class="language-plaintext highlighter-rouge">docker run -d -p 3000:3000 grafana/grafana</code>.</strong> After running this command, you can access Grafana by navigating to <code class="language-plaintext highlighter-rouge">http://localhost:3000</code> in your browser.</p> <p>If you set up Grafana successfully, you should see the login page as shown below:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/Login-480.webp 480w,/ps-cv/assets/img/grafana/Login-800.webp 800w,/ps-cv/assets/img/grafana/Login-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/Login.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Grafana Login Page" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Grafana Login Page </div> <p>What? are you asking me for the default username and password? Well, I don’t want to spoil the fun for you. Go ahead and find it out yourself. If you still can’t find it, you can always refer to the <a href="https://grafana.com/docs/grafana/latest/installation/">Grafana documentation</a> or leave me a comment below and I will teach you hands-on.</p> <h3 id="data-sources">Data Sources</h3> <p>Grafana supports a wide range of data sources, including Graphite, Prometheus, InfluxDB, Elasticsearch, and many more. You can easily connect Grafana to these data sources by configuring the data source settings in Grafana. Here is a quick guide to help you get started: <a href="https://grafana.com/docs/grafana/latest/features/datasources/">Grafana Data Sources Guide</a>.</p> <ul> <li><strong>How to Add a Data Source</strong>: To add a data source, navigate to the Configuration &gt; Data Sources page in Grafana and click on the “Add data source” button as shown in the image below.</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/datasource-480.webp 480w,/ps-cv/assets/img/grafana/datasource-800.webp 800w,/ps-cv/assets/img/grafana/datasource-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/datasource.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Add Data Source" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Add Data Source </div> <ul> <li>Select the data source you want to add, configure the data source settings, and click on the “Save &amp; Test” button to save the data source settings. Grafana actually provides a lot of options to configure the data source settings, so make sure to explore them to get the most out of your data source. Here in this example we will be using Prometheus as our data source. <strong>Note</strong>: Here we assume that you have correctly set up Prometheus and it is running on your local machine. If you haven’t set up Prometheus yet, you can refer to the <a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus documentation</a> to get started.</li> <li>But wait, why do we need Prometheus as our data source? Well, Prometheus is a popular monitoring and alerting tool that is widely used in the industry. It is a great choice for monitoring your applications and infrastructure, and Grafana provides excellent support for Prometheus. So, since our topic is to cover how you can set up grafana for monitoring your server metrics, we will be using Prometheus as our data source. In the image below, you can see how we have configured Prometheus as our data source in Grafana. Since we are running Prometheus on our local machine, we’ll just skip the TLS/SSL settings and click on the “Save &amp; Test” button to save the data source settings as shown in the image below. I really like the way Grafana provides a test button to test the data source settings. It makes it easy to verify if the data source is correctly configured or not.</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/saveandtest-480.webp 480w,/ps-cv/assets/img/grafana/saveandtest-800.webp 800w,/ps-cv/assets/img/grafana/saveandtest-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/saveandtest.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Save and Test Data Source" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Save and Test Data Source </div> <h3 id="dashboards">Dashboards</h3> <p>Dashboards are the heart and soul of Grafana. They allow you to visualize your data in a meaningful way and gain insights from it. You can create custom dashboards in Grafana by adding panels that display your data in various formats like graphs, tables, and gauges. Here is a quick guide to help you get started: <a href="https://grafana.com/docs/grafana/latest/features/dashboard/dashboards/">Grafana Dashboards Guide</a>.</p> <ul> <li><strong>How to Create a Dashboard</strong>: To create a dashboard, navigate to the Create &gt; Dashboard page in Grafana and click on the “Add new panel” button as shown in the image below.</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/dashboard-480.webp 480w,/ps-cv/assets/img/grafana/dashboard-800.webp 800w,/ps-cv/assets/img/grafana/dashboard-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/dashboard.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Add New Panel" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Add New Panel </div> <ul> <li><strong>How to Use a Pre-built Dashboard</strong>: Grafana also provides a library of pre-built dashboards that you can use to monitor your data. You can import these dashboards into Grafana by navigating to the Create &gt; Dashboard page and clicking on the “Import” button as shown in the image below. You can then upload the JSON file into the text area and click on the “Load” button to import the dashboard. If you have the dashboard ID, you can also import the dashboard by navigating to the Create &gt; Dashboard page and clicking on the “Import” button as shown in the image below. You can then enter the dashboard id in the text area and click on the “Load” button to import the dashboard. In the image below, you can see how we have imported a pre-built dashboard into Grafana.</li> <li><strong>After Creating a Dashboard</strong>: Once you have created a dashboard, you can customize it by adding panels, changing the layout, and configuring the panel settings. You can also share the dashboard with others by exporting it as a JSON file or embedding it in a web page. In the image below, you can see how we have customized a dashboard in Grafana. This is an example of a dashboard that displays server metrics collected by Prometheus from PVE Exporter. This is used to monitor my home server and keep an eye on the server metrics like CPU usage, memory usage, disk usage, and network traffic. (To Dell: If you could have just provide user with a better ipmi tool, I wouldn’t have to use PVE Exporter to monitor my server. But anyways, I am happy with the setup now.)</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/pve-grafana-480.webp 480w,/ps-cv/assets/img/grafana/pve-grafana-800.webp 800w,/ps-cv/assets/img/grafana/pve-grafana-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/pve-grafana.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Proxmox Server Metric Monitoring Dashboard" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Proxmox Server Metric Monitoring Dashboard </div> <p>In the example above, you can easily see the metric values like CPU usage, memory usage, disk usage, and network traffic. By looking at the dashboard, I can easily tell that the Memory Usage of my qemu/109 is quite high. As a DevOp, you better know what to do when you come across this situation. I would log into the guest machine and pull out the memory usage of the processes running on the machine to identify the culprit. Well I can guarantee you that I don’t have culprit or malware running on my machine. It’s just that I had too much stuff stored in the Disk and Synology DSM was probably doing some background cleaning and sorting tasks.</p> <p>Now that you have a basic understanding of how to create and customize dashboards in Grafana, you can start exploring the various features and options available in Grafana to create stunning visualizations of your data. Remember, the sky’s the limit when it comes to Grafana dashboards!</p> <h2 id="prometheus-from-raw-metrics-to-symphony-of-insights">Prometheus: From Raw Metrics to Symphony of Insights</h2> <p>You might wonder why it sounds so easy to set up a Grafana Dashboard. Well, the secret sauce behind this is Prometheus. Prometheus is an open-source monitoring and alerting toolkit that is widely used in the industry. It provides a powerful data model, a flexible query language, and a sophisticated alerting system that makes it easy to monitor your applications and infrastructure. Prometheus collects metrics from your applications and infrastructure and stores them in a time-series database. You can then query these metrics using the Prometheus query language and visualize them in Grafana. This is why Prometheus is a great choice for monitoring your server metrics and Grafana is a great choice for visualizing these metrics. Together, they make a powerful combination that can help you monitor and troubleshoot your applications and infrastructure with ease. And I gotta be honest with you that it took me a while to properly set up Prometheus and PVE Exporter to monitor my Proxmox server. If you come across any issues while setting up Prometheus, here is a hint: <strong>Check the certificates and user permission.</strong> I know this sounds like a generic hint, but trust me, it can save you a lot of time.</p> <p>But in order to monitor your server metrics, there are a few additional set up that you need to do. You need to install Prometheus on your server and <strong>configure it</strong> to collect metrics from your applications and infrastructure. How to do that? Well, you can refer to the <a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus documentation</a> to get started. Or you can follow this GitHub Repo <a href="https://github.com/prometheus-pve/prometheus-pve-exporter">Prometheus-PVE-Exporter</a>. These tutorials will guide you through the process of installing Prometheus on your server and configuring it to collect metrics from your applications and infrastructure. Once you have Prometheus set up and running, you can configure Grafana to connect to Prometheus and start visualizing your server metrics. And that’s how you can set up Grafana for monitoring your server metrics using Prometheus. This is specifically useful for monitoring your Proxmox server metrics. Below is my Prometheus configurations for monitoring my Proxmox server metrics. You can see that I have configured Prometheus to scrape the metrics from PVE Exporter, which is running on my Proxmox server. This is how Prometheus collects the metrics from my Proxmox server and stores them in a time-series database. You can then query these metrics using the Prometheus query language and visualize them in Grafana. This is how I monitor my Proxmox server metrics using Grafana and Prometheus. If you have any questions or need help setting up Prometheus and Grafana for monitoring your server metrics, feel free to leave me a comment below. I’ll be happy to help you out.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span> <span class="c1"># Set this wisely because it will affect the performance of your server.</span>
  <span class="na">evaluation_interval</span><span class="pi">:</span> <span class="s">15s</span> <span class="c1"># Evaluate rules every 15 seconds. The default is every 1 minute.</span>
  <span class="c1"># scrape_timeout is set to the global default (10s).</span>

<span class="c1"># Alertmanager configuration</span>
<span class="na">alerting</span><span class="pi">:</span>
  <span class="na">alertmanagers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">static_configs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
          <span class="c1"># - alertmanager:9093</span>

<span class="na">rule_files</span><span class="pi">:</span>
  <span class="c1"># - "first_rules.yml" This is where you can define your rule files. I would recommend you to keep your rules in a separate file and include them here. Since I am don't have a sophisticated setup, I have kept my rules in the same file.</span>
  <span class="c1"># - "second_rules.yml"</span>
<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="c1"># Job No. 1: Scrape the Prometheus server itself.</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">prometheus"</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">localhost:9090"</span><span class="pi">]</span>
  <span class="c1"># Job No. 2: Scrape the Proxmox server metrics using PVE Exporter.</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pve"</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">pve.you-do-not-have-permission.ts.net</span> <span class="c1"># Proxmox host. You can replace this with your Proxmox VE host. Since I am using Tailscale, I have used the hostname provided by Tailscale.</span>
    <span class="na">metrics_path</span><span class="pi">:</span> <span class="s">/pve</span>
    <span class="na">scheme</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https"</span>
    <span class="na">params</span><span class="pi">:</span>
      <span class="na">module</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">default</span><span class="pi">]</span>
    <span class="na">relabel_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__address__</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">__param_target</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__param_target</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">instance</span>
      <span class="pi">-</span> <span class="na">target_label</span><span class="pi">:</span> <span class="s">__address__</span>
        <span class="na">replacement</span><span class="pi">:</span> <span class="s">portainer.stonecat-duck.ts.net:9221</span> <span class="c1"># PVE Exporter host. You can replace this with your PVE Exporter host. This is the port that PVE Exporter is running on.</span>

    <span class="c1"># Job No. 3: Scrape the Traefik metrics using Traefik Exporter.</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">traefik"</span>
    <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span>
    <span class="na">scrape_timeout</span><span class="pi">:</span> <span class="s">10s</span>
    <span class="na">metrics_path</span><span class="pi">:</span> <span class="s">/metrics</span>
    <span class="na">scheme</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">another-service:$PORT</span><span class="nv"> </span><span class="s">NUMBER"</span><span class="pi">]</span> <span class="c1"># Traefik host. You can replace this with your Traefik host.</span>
    <span class="na">basic_auth</span><span class="pi">:</span> <span class="c1"># Basic authentication. You can replace this with your basic authentication credentials. Not advised to use basic authentication. Use a more secure method but here I am running all of the service in local network and I am the only user, I will just skip the security part.</span>
      <span class="na">username</span><span class="pi">:</span> <span class="s">username-for-real</span>
      <span class="na">password</span><span class="pi">:</span> <span class="s">nobody-should-know-this</span>
    <span class="c1"># Job No. 4: Scrape the Nvidia GPU metrics using Nvidia GPU Exporter.</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Tesla</span><span class="nv"> </span><span class="s">M40"</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">your-gpu-host:9835"</span><span class="pi">]</span> <span class="c1"># Nvidia GPU host. You can replace this with your Nvidia GPU host. This is the port that Nvidia GPU Exporter is running on. Make sure this is the correct address and port. Here I was running the Nvidia GPU Exporter on my Nvidia GPU host which is not the same as my PVE Exporter host.</span>
</code></pre></div></div> <p>You probably need to tweak the configurations according to your setup. But this is how I have set up Prometheus to scrape the metrics from my Proxmox server using PVE Exporter. As I am using Docker, all I need to do is to mount the configuration file to the Prometheus container and start the container. Below is the docker-compose.yml file that I used to start the Prometheus container. <strong>It Only Contained the Prometheus Service. I have other services running as well. So Tweak it based on your need.</strong></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">prometheus-data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring_network</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.prometheus.rule=Host(`portainer.stonecat-duck.ts.net`)&amp;&amp;PathPrefix(`/prometheus`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.prometheus.loadbalancer.server.port=9090"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.prometheus.entrypoints=web"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span> <span class="c1"># You may use other ports as well. I have used 9090 because it is the default port for Prometheus.</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/root/prometheus/config:/etc/prometheus/config</span> <span class="c1">#This is where I have stored my Prometheus configuration file. You can replace this with your configuration file path. Incorrect configuration file path will result in an error. The behavior of Prometheus is to not able to scrape the metrics from the target.</span>
      <span class="pi">-</span> <span class="s">/root/tsCert/:/etc/prometheus/cert/</span> <span class="c1">#This is where I have stored my certificates. You can replace this with your certificate path. Incorrect certificate path will result in an error. The behavior of Prometheus is to not able to scrape the metrics from the target.</span>
      <span class="pi">-</span> <span class="s">prometheus-data:/prometheus</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--config.file=/etc/prometheus/config/prometheus.yml"</span> <span class="c1"># The container need to know where the configuration file is stored. This is the path to the configuration file. Make sure this is the correct_path in your container not your host machine.</span>
  <span class="c1">#Something Else Here</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">traefik_network</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">monitoring_network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre></div></div> <p>By properly setting up Prometheus and Grafana, you can monitor your server metrics with ease and gain valuable insights into the performance of your applications and infrastructure. We can go to the Prometheus WEBUI and see the metrics that Prometheus is scraping from the target. This is how you can monitor your server metrics using Grafana and Prometheus. Below is a screenshot of my Prometheus target page. As you can see currently every tartget that I monitor is up. If you see any target down, you need to check the configurations and make sure that the target is up and running. If the target is down, Prometheus will not be able to scrape the metrics from the target and you will not be able to visualize the metrics in Grafana. So make sure that all your targets are up and running.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/grafana/prometheus-target-480.webp 480w,/ps-cv/assets/img/grafana/prometheus-target-800.webp 800w,/ps-cv/assets/img/grafana/prometheus-target-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/grafana/prometheus-target.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Prometheus Targets" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Figure: Prometheus Targets </div> <h2 id="epilogue-this-is-just-the-beginning">Epilogue: This is Just the Beginning</h2> <p>Congratulations! You’ve taken your first steps into the world of Grafana and Prometheus. But remember, this is just the beginning of your journey. There’s so much more to explore and learn in the realm of monitoring and alerting. Dive deeper into the world of Grafana plugins, explore the vast landscape of data sources, and master the art of creating stunning dashboards that tell a story. And don’t forget to share your knowledge with others in the Grafana community. Together, we can build a world where data is not just a number but a powerful tool for change. So go forth, brave explorer, and chart your course through the data-driven universe with Grafana and Prometheus as your trusty companions. Happy monitoring!</p>]]></content><author><name></name></author><category term="Observability"/><category term="data"/><category term="IoT"/><category term="Observability"/><summary type="html"><![CDATA[Tired of BI? Or Tableau too expensive? Well, try Grafana, or d3js(Come on, all the options available, don't get yourself robbed)]]></summary></entry><entry><title type="html">Flat.io</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/code-diff/" rel="alternate" type="text/html" title="Flat.io"/><published>2024-01-27T19:22:00+00:00</published><updated>2024-01-27T19:22:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/code-diff</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/code-diff/"><![CDATA[<div id="embed-container"></div> <p><button id="export-xml">Export to MusicXML</button></p> <script src="https://prod.flat-cdn.com/embed-js/v1.5.1/embed.min.js"></script> <script>var container=document.getElementById("embed-container"),embed=new Flat.Embed(container,{score:"67781c39ddc1a53c345019fc",embedParams:{mode:"edit",appId:"67781e2b4df43565f09bb669",branding:!1,controlsPosition:"top"}});document.getElementById("export-xml").addEventListener("click",function(){embed.getMusicXML({compressed:!0}).then(function(){})});</script>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="code"/><summary type="html"><![CDATA[this is how you can embed a PDF directly into a post]]></summary></entry><entry><title type="html">a post with advanced image components</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/advanced-images/" rel="alternate" type="text/html" title="a post with advanced image components"/><published>2024-01-27T11:46:00+00:00</published><updated>2024-01-27T11:46:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/advanced-images</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/advanced-images/"><![CDATA[<p>This is an example post with advanced image components.</p> <h2 id="image-slider">Image Slider</h2> <p>This is a simple image slider. It uses the <a href="https://swiperjs.com/">Swiper</a> library. Check the <a href="https://swiperjs.com/demos">examples page</a> for more information of what you can achieve with it.</p> <swiper-container keyboard="true" navigation="true" pagination="true" pagination-clickable="true" pagination-dynamic-bullets="true" rewind="true"> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/9-480.webp 480w,/ps-cv/assets/img/9-800.webp 800w,/ps-cv/assets/img/9-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/7-480.webp 480w,/ps-cv/assets/img/7-800.webp 800w,/ps-cv/assets/img/7-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/7.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/8-480.webp 480w,/ps-cv/assets/img/8-800.webp 800w,/ps-cv/assets/img/8-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/8.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/10-480.webp 480w,/ps-cv/assets/img/10-800.webp 800w,/ps-cv/assets/img/10-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/10.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/12-480.webp 480w,/ps-cv/assets/img/12-800.webp 800w,/ps-cv/assets/img/12-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/12.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </swiper-slide> </swiper-container> <h2 id="image-comparison-slider">Image Comparison Slider</h2> <p>This is a simple image comparison slider. It uses the <a href="https://img-comparison-slider.sneas.io/">img-comparison-slider</a> library. Check the <a href="https://img-comparison-slider.sneas.io/examples.html">examples page</a> for more information of what you can achieve with it.</p> <img-comparison-slider> <figure slot="first"> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/prof_pic-480.webp 480w,/ps-cv/assets/img/prof_pic-800.webp 800w,/ps-cv/assets/img/prof_pic-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/prof_pic.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <figure slot="second"> <picture> <source class="responsive-img-srcset" srcset="/ps-cv/assets/img/prof_pic_color-480.webp 480w,/ps-cv/assets/img/prof_pic_color-800.webp 800w,/ps-cv/assets/img/prof_pic_color-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/ps-cv/assets/img/prof_pic_color.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </img-comparison-slider>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="images"/><summary type="html"><![CDATA[this is what advanced image components could look like]]></summary></entry><entry><title type="html">a post with geojson</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/geojson-map/" rel="alternate" type="text/html" title="a post with geojson"/><published>2024-01-26T17:57:00+00:00</published><updated>2024-01-26T17:57:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/geojson-map</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/geojson-map/"><![CDATA[<p>This is an example post with some <a href="https://geojson.org/">geojson</a> code. The support is provided thanks to <a href="https://leafletjs.com/">Leaflet</a>. To create your own visualization, go to <a href="https://geojson.io/">geojson.io</a>.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">geojson
</span><span class="sb">{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          [
            [
              -60.11363029935569,
              -2.904625022183211
            ],
            [
              -60.11363029935569,
              -3.162613728707967
            ],
            [
              -59.820894493858034,
              -3.162613728707967
            ],
            [
              -59.820894493858034,
              -2.904625022183211
            ],
            [
              -60.11363029935569,
              -2.904625022183211
            ]
          ]
        ],
        "type": "Polygon"
      }
    }
  ]
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <pre><code class="language-geojson">{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "coordinates": [
          [
            [
              -60.11363029935569,
              -2.904625022183211
            ],
            [
              -60.11363029935569,
              -3.162613728707967
            ],
            [
              -59.820894493858034,
              -3.162613728707967
            ],
            [
              -59.820894493858034,
              -2.904625022183211
            ],
            [
              -60.11363029935569,
              -2.904625022183211
            ]
          ]
        ],
        "type": "Polygon"
      }
    }
  ]
}
</code></pre>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="charts"/><category term="maps"/><summary type="html"><![CDATA[this is what included geojson code could look like]]></summary></entry><entry><title type="html">a post with echarts</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/echarts/" rel="alternate" type="text/html" title="a post with echarts"/><published>2024-01-26T16:03:00+00:00</published><updated>2024-01-26T16:03:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/echarts</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/echarts/"><![CDATA[<p>This is an example post with some <a href="https://echarts.apache.org/">echarts</a> code.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">echarts
</span><span class="sb">{
  "title": {
    "text": "ECharts Getting Started Example"
  },
  "responsive": true,
  "tooltip": {},
  "legend": {
    "top": "30px",
    "data": ["sales"]
  },
  "xAxis": {
    "data": ["Shirts", "Cardigans", "Chiffons", "Pants", "Heels", "Socks"]
  },
  "yAxis": {},
  "series": [
    {
      "name": "sales",
      "type": "bar",
      "data": [5, 20, 36, 10, 10, 20]
    }
  ]
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <pre><code class="language-echarts">{
  "title": {
    "text": "ECharts Getting Started Example"
  },
  "responsive": true,
  "tooltip": {},
  "legend": {
    "top": "30px",
    "data": ["sales"]
  },
  "xAxis": {
    "data": ["Shirts", "Cardigans", "Chiffons", "Pants", "Heels", "Socks"]
  },
  "yAxis": {},
  "series": [
    {
      "name": "sales",
      "type": "bar",
      "data": [5, 20, 36, 10, 10, 20]
    }
  ]
}
</code></pre> <p>Note that this library offer support for both light and dark themes. You can switch between them using the theme switcher in the top right corner of the page.</p>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="charts"/><summary type="html"><![CDATA[this is what included echarts code could look like]]></summary></entry><entry><title type="html">a post with chart.js</title><link href="https://tingrubato.github.io/ps-cv/blog/2024/chartjs/" rel="alternate" type="text/html" title="a post with chart.js"/><published>2024-01-26T01:04:00+00:00</published><updated>2024-01-26T01:04:00+00:00</updated><id>https://tingrubato.github.io/ps-cv/blog/2024/chartjs</id><content type="html" xml:base="https://tingrubato.github.io/ps-cv/blog/2024/chartjs/"><![CDATA[<p>This is an example post with some <a href="https://www.chartjs.org/">chart.js</a> code.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">chartjs
</span><span class="sb">{
  "type": "line",
  "data": {
    "labels": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July"
    ],
    "datasets": [
      {
        "label": "# of bugs",
        "fill": false,
        "lineTension": 0.1,
        "backgroundColor": "rgba(75,192,192,0.4)",
        "borderColor": "rgba(75,192,192,1)",
        "borderCapStyle": "butt",
        "borderDash": [],
        "borderDashOffset": 0,
        "borderJoinStyle": "miter",
        "pointBorderColor": "rgba(75,192,192,1)",
        "pointBackgroundColor": "#fff",
        "pointBorderWidth": 1,
        "pointHoverRadius": 5,
        "pointHoverBackgroundColor": "rgba(75,192,192,1)",
        "pointHoverBorderColor": "rgba(220,220,220,1)",
        "pointHoverBorderWidth": 2,
        "pointRadius": 1,
        "pointHitRadius": 10,
        "data": [
          65,
          59,
          80,
          81,
          56,
          55,
          40
        ],
        "spanGaps": false
      }
    ]
  },
  "options": {}
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>This is how it looks like:</p> <pre><code class="language-chartjs">{
  "type": "line",
  "data": {
    "labels": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July"
    ],
    "datasets": [
      {
        "label": "# of bugs",
        "fill": false,
        "lineTension": 0.1,
        "backgroundColor": "rgba(75,192,192,0.4)",
        "borderColor": "rgba(75,192,192,1)",
        "borderCapStyle": "butt",
        "borderDash": [],
        "borderDashOffset": 0,
        "borderJoinStyle": "miter",
        "pointBorderColor": "rgba(75,192,192,1)",
        "pointBackgroundColor": "#fff",
        "pointBorderWidth": 1,
        "pointHoverRadius": 5,
        "pointHoverBackgroundColor": "rgba(75,192,192,1)",
        "pointHoverBorderColor": "rgba(220,220,220,1)",
        "pointHoverBorderWidth": 2,
        "pointRadius": 1,
        "pointHitRadius": 10,
        "data": [
          65,
          59,
          80,
          81,
          56,
          55,
          40
        ],
        "spanGaps": false
      }
    ]
  },
  "options": {}
}
</code></pre> <p>Also another example chart.</p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">```</span><span class="nl">chartjs
</span><span class="sb">{
  "type": "doughnut",
  "data": {
    "labels": [
      "Red",
      "Blue",
      "Yellow"
    ],
    "datasets": [
      {
        "data": [
          300,
          50,
          100
        ],
        "backgroundColor": [
          "#FF6384",
          "#36A2EB",
          "#FFCE56"
        ],
        "hoverBackgroundColor": [
          "#FF6384",
          "#36A2EB",
          "#FFCE56"
        ]
      }
    ]
  },
  "options": {}
}</span>
<span class="p">```</span>
</code></pre></div></div> <p>Which generates:</p> <pre><code class="language-chartjs">{
  "type": "doughnut",
  "data": {
    "labels": [
      "Red",
      "Blue",
      "Yellow"
    ],
    "datasets": [
      {
        "data": [
          300,
          50,
          100
        ],
        "backgroundColor": [
          "#FF6384",
          "#36A2EB",
          "#FFCE56"
        ],
        "hoverBackgroundColor": [
          "#FF6384",
          "#36A2EB",
          "#FFCE56"
        ]
      }
    ]
  },
  "options": {}
}
</code></pre>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="charts"/><summary type="html"><![CDATA[this is what included chart.js code could look like]]></summary></entry></feed>